MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;********************************************************
                      00002 ; RPM Counter
                      00003 ;********************************************************
                      00004 
                      00005         list            p=pic16f84a
                      00006         include         p16f84a.inc
                      00001         LIST
                      00002 ; P16F84A.INC  Standard Header File, Version 2.00    Microchip Technology, Inc.
                      00134         LIST
2007   3FF2           00007         __config _HS_OSC & _WDT_OFF & _PWRTE_ON & _CP_OFF
                      00008         errorlevel      -302    ;Eliminate bank warning
                      00009 
                      00010                 include                 macro.inc
                      00001 
                      00002 ;       Pic macro
                      00003 
  0000004F            00004 TempWreg        equ             h'4f'
                      00005 
                      00006 
                      00007 pcall   macro   Addr
                      00008                 movlw   high Addr
                      00009                 movwf   PCLATH
                      00010                 call    Addr
                      00011                 movlw   high $
                      00012                 movwf   PCLATH
                      00013                 endm
                      00014 
                      00015 pgoto   macro   Addr
                      00016                 movlw   high Addr
                      00017                 movwf   PCLATH
                      00018                 goto    Addr
                      00019                 endm
                      00020 
                      00021 ; Compre macro
                      00022 
                      00023 cmpsz   macro   val
                      00024                 movwf   TempWreg
                      00025                 sublw   val
                      00026                 swapf   TempWreg,F
                      00027                 swapf   TempWreg,W
                      00028                 btfss   STATUS,Z
                      00029                 endm
                      00030 
                      00031 cmpsnz  macro   val
                      00032                 movwf   TempWreg
                      00033                 sublw   val
                      00034                 swapf   TempWreg,F
                      00035                 swapf   TempWreg,W
                      00036                 btfsc   STATUS,Z
                      00037                 endm
                      00038 
                      00039 cmpscc  macro   val
                      00040                 movwf   TempWreg
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00041                 sublw   val
                      00042                 swapf   TempWreg,F
                      00043                 swapf   TempWreg,W
                      00044                 btfsc   STATUS,C
                      00045                 endm
                      00046 
                      00047 cmpscs  macro   val
                      00048                 movwf   TempWreg
                      00049                 sublw   val
                      00050                 swapf   TempWreg,F
                      00051                 swapf   TempWreg,W
                      00052                 btfss   STATUS,C
                      00053                 endm
                      00054 
                      00055 ;               movlw   H'12'
                      00056 ;               cmpsz   H'12'   ; Equal Skip
                      00057 ;               nop                             ; skip
                      00058 ;               cmpsnz  H'12'   ; Not Eaqual Skip
                      00059 ;               nop                             ; exec
                      00060 ;               cmpscc  H'1'    ; Wreg > k to Skip
                      00061 ;               nop                             ; skip
                      00062 ;               cmpscc  H'13' 
                      00063 ;               nop                             ; exec
                      00064 ;               cmpscs  H'1'    ; Wreg < k to Skip
                      00065 ;               nop                             ; exec
                      00066 ;               cmpscs  H'13'
                      00067 ;               nop                             ; skip
                      00068 
                      00069 
                      00070 add16ff macro   addfile1,addfile2,distfile
                      00071                 movf    addfile1,W
                      00072                 addwf   addfile2,W
                      00073                 movwf   distfile
                      00074                 movf    addfile1+1,W
                      00075                 btfsc   STATUS,C
                      00076                 incf    addfile1+1,W
                      00077                 addwf   addfile2+1,W
                      00078                 movwf   distfile+1
                      00079                 endm
                      00080 
                      00081 
                      00082 ; compfile1 smole equal big
                      00083 cmp16ff macro   compfile1,compfile2,AddrS,AddrE,AddrB
                      00084                 movf    compfile1+1,W
                      00085                 addlw   H'80'
                      00086                 movwf   TempWreg
                      00087                 movf    compfile2+1,W
                      00088                 addlw   H'80'
                      00089                 subwf   TempWreg,W
                      00090                 btfsc   STATUS,Z
                      00091                 goto    $+4
                      00092                 btfsc   STATUS,C
                      00093                 goto    AddrS
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00094                 goto    AddrB
                      00095                 movf    compfile2,W
                      00096                 subwf   compfile1,W
                      00097                 btfsc   STATUS,Z
                      00098                 goto    AddrE
                      00099                 btfsc   STATUS,C
                      00100                 goto    AddrS
                      00101                 goto    AddrB
                      00102                 endm
                      00103 
                      00104 
                      00105                 
                      00011 
                      00012 
                      00013 
                      00014 
                      00015 ;****************  Label Definition  ********************
                      00016 
                      00017 ;****************  SRAM define  ********************
                      00018                 cblock          h'0c'
  0000000C            00019 IntSaveWreg
  0000000D            00020 IntSaveStatus
  0000000E            00021 IntSavePclath
  0000000F            00022 IntSaveFsr
                      00023 
  00000010            00024 Timer1
  00000011            00025 Timer2
  00000012            00026 Timer3
  00000013            00027 Timer4
                      00028 
  00000014            00029 OldTimer1
                      00030 
  00000015            00031 Scan1
  00000016            00032 Scan2
  00000017            00033 Scan3
  00000018            00034 Scan4
                      00035 
  00000019            00036 OldRpm1
  0000001A            00037 OldRpm2
                      00038 
  0000001B            00039 IntRb0
  0000001C            00040 IntSkip
  0000001D            00041 LedPort
  0000001E            00042 Led1
  0000001F            00043 Led2
  00000020            00044 Led3
  00000021            00045 Led4
  00000022            00046 Led5
                      00047 
                      00048 
                      00049                 endc
                      00050 ;****************  Program Start  ***********************
0000                  00051         org     0               ;Reset Vector
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0000   286D           00052         goto    PowerOnReset
0004                  00053         org     4               ;Interrupt Vector
                      00054 ;*************** Interrupt*************
0004                  00055 InterruptProc
0004   008C           00056                 movwf   IntSaveWreg
0005   0801           00057                 movf    TMR0,W
0006   0090           00058                 movwf   Timer1
0007   0E03           00059                 swapf   STATUS,W
0008   008D           00060                 movwf   IntSaveStatus
0009   080A           00061                 movf    PCLATH,W
000A   008E           00062                 movwf   IntSavePclath
                      00063 
                      00064 ; Check Interrupt Flag
000B   190B           00065                 btfsc   INTCON,T0IF
000C   2018           00066                 call    TimerInterrupt
000D   188B           00067                 btfsc   INTCON,INTF
000E   2052           00068                 call    Rb0Interrupt
000F   201F           00069                 call    LedDrive
                      00070 
0010   0064           00071                 clrwdt                                          ;Clear watch dog timer and Prescaler
0011   080E           00072                 movf    IntSavePclath,W
0012   008A           00073                 movwf   PCLATH
0013   0E0D           00074                 swapf   IntSaveStatus,W
0014   0083           00075                 movwf   STATUS
0015   0E8C           00076                 swapf   IntSaveWreg,F
0016   0E0C           00077                 swapf   IntSaveWreg,W
0017   0009           00078                 retfie
                      00079 ;*************** TIMER INT Proc ******************
0018                  00080 TimerInterrupt
                      00081 
                      00082 ; Timer incliment (24Bit+TimerA)
0018   0F91           00083                 incfsz  Timer2,F
0019   281D           00084                 goto    TimerAddEnd
001A   0F92           00085                 incfsz  Timer3,F
001B   281D           00086                 goto    TimerAddEnd
001C   0A93           00087                 incf    Timer4,F
001D                  00088 TimerAddEnd
                      00089 
001D   110B           00090                 bcf             INTCON,T0IF
001E   0008           00091                 return
                      00092 ;*************** LED Drive Proc ********************
001F                  00093 LedDrive
001F   0B9C           00094                 decfsz  IntSkip,F
0020   0008           00095                 return
                      00096 
0021   2035           00097                 call    GetLedPortA
0022   0085           00098                 movwf   PORTA
0023   0804           00099                 movf    FSR,W
0024   008F           00100                 movwf   IntSaveFsr
0025   301E           00101                 movlw   Low Led1
0026   071D           00102                 addwf   LedPort,W
0027   0084           00103                 movwf   FSR
0028   0800           00104                 movf    INDF,W
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0029   2040           00105                 call    GetLedPortB
002A   0086           00106                 movwf   PORTB
Message[305]: Using default destination of 1 (file).
002B   088F           00107                 movf    IntSaveFsr
002C   0084           00108                 movwf   FSR
                      00109 
002D   0A9D           00110                 incf    LedPort,F
002E   3005           00111                 movlw   H'05'
002F   021D           00112                 subwf   LedPort,W
0030   1903           00113                 btfsc   STATUS,Z
0031   019D           00114                 clrf    LedPort
                      00115 
0032   300C           00116                 movlw   H'0c'
0033   009C           00117                 movwf   IntSkip
0034   0008           00118                 return
                      00119 
0035                  00120 GetLedPortA
0035   081D           00121                 movf    LedPort,W
0036   3907           00122                 andlw   H'07'
0037   0782           00123                 addwf   PCL,F
0038   3401           00124                 retlw   H'01'
0039   3402           00125                 retlw   H'02'
003A   3404           00126                 retlw   H'04'
003B   3408           00127                 retlw   H'08'
003C   3410           00128                 retlw   H'10'
003D   3400           00129                 retlw   H'00'
003E   3400           00130                 retlw   H'00'
003F   3400           00131                 retlw   H'00'
                      00132 
0040                  00133 GetLedPortB
0040   390F           00134                 andlw   H'0f'
0041   0782           00135                 addwf   PCL,F
0042   34BE           00136                 retlw   B'10111110'
0043   3430           00137                 retlw   B'00110000'
0044   34EC           00138                 retlw   B'11101100'
0045   34F8           00139                 retlw   B'11111000'
0046   3472           00140                 retlw   B'01110010'
0047   34DA           00141                 retlw   B'11011010'
0048   34DE           00142                 retlw   B'11011110'
0049   34B2           00143                 retlw   B'10110010'
004A   34FE           00144                 retlw   B'11111110'
004B   34FA           00145                 retlw   B'11111010'
004C   34F6           00146                 retlw   B'11110110'
004D   345E           00147                 retlw   B'01011110'
004E   348E           00148                 retlw   B'10001110'
004F   347C           00149                 retlw   B'01111100'
0050   34CE           00150                 retlw   B'11001110'
0051   34C6           00151                 retlw   B'11000110'
                      00152 
                      00153 ;*************** RB0 INT Proc ********************
0052                  00154 Rb0Interrupt
0052   1E0B           00155                 btfss   INTCON,INTE                     ; RB0 Interrupt Enable check
0053   0008           00156                 return
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00157 
0054   0811           00158                 movf    Timer2,W
0055   0096           00159                 movwf   Scan2
0056   0812           00160                 movf    Timer3,W
0057   0097           00161                 movwf   Scan3
0058   0813           00162                 movf    Timer4,W
0059   0098           00163                 movwf   Scan4
                      00164 
005A   0191           00165                 clrf    Timer2
005B   0192           00166                 clrf    Timer3
005C   0193           00167                 clrf    Timer4
                      00168 
005D   0814           00169                 movf    OldTimer1,W                     ; Lead Timer Adjustment
005E   0210           00170                 subwf   Timer1,W
005F   0095           00171                 movwf   Scan1
0060   3001           00172                 movlw   H'01'
0061   1C03           00173                 btfss   STATUS,C
0062   0296           00174                 subwf   Scan2,F
0063   1C03           00175                 btfss   STATUS,C
0064   0297           00176                 subwf   Scan3,F
0065   1C03           00177                 btfss   STATUS,C
0066   0298           00178                 subwf   Scan4,F
                      00179 
0067   0810           00180                 movf    Timer1,W
0068   0094           00181                 movwf   OldTimer1
                      00182 
0069   141B           00183                 bsf             IntRb0,0                        ; RB0 Interrupt Flag
006A   108B           00184                 bcf             INTCON,INTF                     ; Clear RB Int
006B   160B           00185                 bsf             INTCON,INTE                     ; RB0 Interrupt Enable
006C   0008           00186                 return
                      00187 ;****************  Initial Process  *********************
006D                  00188 PowerOnReset
006D   1683           00189                 bsf             STATUS,RP0                      ;Change to Bank1 
006E   0064           00190                 clrwdt                                          ;Clear watch dog timer and Prescaler
006F   3000           00191                 movlw   H'00'
0070   0085           00192                 movwf   TRISA                           ;Set PORTA All Output
0071   3001           00193                 movlw   H'01'
0072   0086           00194                 movwf   TRISB                           ;Set PORTB to Output/Input(Bit0) mode
0073   3001           00195                 movlw   H'01'
0074   0081           00196                 movwf   OPTION_REG                      ;RB Input Pull Up & PreScale 1/4
0075   1283           00197                 bcf             STATUS,RP0                      ;Change to Bank0
                      00198 
0076   3000           00199                 movlw   H'00'
0077   0081           00200                 movwf   TMR0                            ; TIMER0 Count Base Value
0078   160B           00201                 bsf             INTCON,INTE                     ; RB0 Interrupt Enable
0079   168B           00202                 bsf             INTCON,T0IE                     ; TIMER0 Interrupt Enable
007A   178B           00203                 bsf             INTCON,GIE                      ; General Interrupt Enable
                      00204 
007B   0191           00205                 clrf    Timer2
007C   0192           00206                 clrf    Timer3
007D   0193           00207                 clrf    Timer4
007E   300C           00208                 movlw   H'0c'
007F   009C           00209                 movwf   IntSkip
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00210 
0080   0195           00211                 clrf    Scan1
0081   0196           00212                 clrf    Scan2
0082   0197           00213                 clrf    Scan3
0083   0198           00214                 clrf    Scan4
                      00215 
0084   0199           00216                 clrf    OldRpm1
0085   019A           00217                 clrf    OldRpm2
                      00218 
0086   0194           00219                 clrf    OldTimer1
0087   019B           00220                 clrf    IntRb0
0088                  00221 MainLoop
0088   1C1B           00222                 btfss   IntRb0,0
0089   2888           00223                 goto    MainLoop
008A   019B           00224                 clrf    IntRb0
                      00225 
008B   3004           00226                 movlw   H'04'           ; CPU clock(5MHz) prescale 1/4 * 60 (047868c0h=75000000)
008C   00B4           00227                 movwf   div1d
008D   3078           00228                 movlw   H'78'           ; ・・
008E   00B5           00229                 movwf   div1c
008F   3068           00230                 movlw   H'68'           ; ・・
0090   00B6           00231                 movwf   div1b
0091   30C0           00232                 movlw   H'c0'           ; LSB
0092   00B7           00233                 movwf   div1a
0093   0818           00234                 movf    Scan4,W         ; divider MSB       (Scan1-4)
0094   00B8           00235                 movwf   div2d
0095   0817           00236                 movf    Scan3,W         ; ・・
0096   00B9           00237                 movwf   div2c
0097   0816           00238                 movf    Scan2,W         ; ・・
0098   00BA           00239                 movwf   div2b
0099   0815           00240                 movf    Scan1,W         ; LSB
009A   00BB           00241                 movwf   div2a
009B   2100           00242                 call    div32           ; Anser -> div3d,c,b,a 縲《urplus div4d,c,b,a return
                      00243 
009C   083D           00244                 movf    div3c,W
009D   1D03           00245                 btfss   STATUS,Z
009E   2888           00246                 goto    MainLoop        ; Chataring Cut ( over 65535RPM )
                      00247 
009F   081A           00248                 movf    OldRpm2,W
00A0   023E           00249                 subwf   div3b,W
00A1   1C03           00250                 btfss   STATUS,C
00A2   28A3           00251                 goto    SkipChataCheck
                      00252 ;               sublw   H'20'
                      00253 ;               btfss   STATUS,C
                      00254 ;               goto    MainLoop                                ; spinup 511RPM over
00A3                  00255 SkipChataCheck
00A3   083E           00256                 movf    div3b,W
00A4   009A           00257                 movwf   OldRpm2
00A5   083F           00258                 movf    div3a,W
00A6   0099           00259                 movwf   OldRpm1
                      00260 
00A7   083E           00261                 movf    div3b,W
00A8   00C7           00262                 movwf   prm1b
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00A9   083F           00263                 movf    div3a,W
00AA   00C8           00264                 movwf   prm1a
00AB   2177           00265                 call    hexdec16
                      00266 
00AC   0849           00267                 movf    prm3e,W
00AD   009E           00268                 movwf   Led1
00AE   084A           00269                 movf    prm3d,W
00AF   009F           00270                 movwf   Led2
00B0   084B           00271                 movf    prm3c,W
00B1   00A0           00272                 movwf   Led3
00B2   084C           00273                 movf    prm3b,W
00B3   00A1           00274                 movwf   Led4
00B4   084D           00275                 movf    prm3a,W
00B5   00A2           00276                 movwf   Led5
                      00277 
00B6   2888           00278                 goto    MainLoop
                      00279 
                      00280 
                      00281                 include                 math.inc
                      00001 ;****************  SRAM define  ********************
                      00002                 cblock  H'34'
  00000034            00003 div1d                           ;割られる数上位　（終了時には０になる）
  00000035            00004 div1c                           ; 〜
  00000036            00005 div1b                           ; 〜
  00000037            00006 div1a                           ;下位
  00000038            00007 div2d                           ;割る数上位       (変化せず戻る）
  00000039            00008 div2c                           ; 〜
  0000003A            00009 div2b                           ; 〜
  0000003B            00010 div2a                           ;下位
  0000003C            00011 div3d                           ;答え上位　　　　（答えが返る）
  0000003D            00012 div3c                           ; 〜
  0000003E            00013 div3b                           ; 〜
  0000003F            00014 div3a                           ;下位
  00000040            00015 div4d                           ;余り上位　　　　（余りが返る、内部ワークにも使用）
  00000041            00016 div4c                           ; 〜
  00000042            00017 div4b                           ; 〜
  00000043            00018 div4a                           ;余り下位
  00000044            00019 divl1                           ;内部ループ用
  00000045            00020 divl2                           ;内部ループ用
  00000046            00021 diverr                          ;割る数が０であった場合に１をセットして戻る
                      00022 
  00000047            00023 prm1b                           ; 変換したい値（１６ビット。変換後は壊れる）
  00000048            00024 prm1a                           ;〜下位
  00000049            00025 prm3e                           ;10進格納場所（５バイト）
  0000004A            00026 prm3d           
  0000004B            00027 prm3c           
  0000004C            00028 prm3b           
  0000004D            00029 prm3a                           ;〜下位
  0000004E            00030 srlc1                           ; カウンタ（サブルーチンで使用）
  0000004F            00031 srwk1                           ; 一時余り格納場所（サブルーチンで使用）
                      00032 
                      00033                 endc
                      00034 
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00035 
0100                  00036                 org             H'100'
                      00037 
                      00038 
                      00039 ;               movlw   0ffh            ;割られる数上位  (ffffffffh=4294967295)
                      00040 ;               movwf   div1d
                      00041 ;               movlw   0ffh            ; 〜
                      00042 ;               movwf   div1c
                      00043 ;               movlw   0ffh            ; 〜
                      00044 ;               movwf   div1b
                      00045 ;               movlw   0ffh            ;下位
                      00046 ;               movwf   div1a
                      00047 
                      00048 ;               movlw   00h             ;割る数上位       (989680h=10000000)
                      00049 ;               movwf   div2d
                      00050 ;               movlw   098h            ; 〜
                      00051 ;               movwf   div2c
                      00052 ;               movlw   096h            ; 〜
                      00053 ;               movwf   div2b
                      00054 ;               movlw   080h            ;下位
                      00055 ;               movwf   div2a
                      00056 
                      00057 ;               call    div32           ;答えは div3d,c,b,a 、余りは div4d,c,b,a に返る
                      00058 
                      00059 ;*********************************************************************
                      00060 ;---------------------------------------------------------------------
                      00061 
0100                  00062 div32           ;３２÷３２ビット＝３２ビットの割り算ルーチン
                      00063                 ;div1d,c,b,a ÷ div2d,c,b,a ＝ 結果 div3d,c,b,a  余り div4d,c,b,a
                      00064                 ;演算後、式の左項（割られる数）は壊れる
                      00065                 ;割る数が０（エラー）なら diverr に１を代入して戻る
                      00066                 ;エラーの場合、引き数は変化しない
                      00067                 ;正常終了の場合は diverr=0 で戻る
                      00068                 ;32ビットで扱える数の最大は 4294967295　(42億9496万7295)
0100   3020           00069                 movlw   H'20'           ;20h=32
0101   00C4           00070                 movwf   divl1
0102   083B           00071                 movf    div2a,W
0103   00C3           00072                 movwf   div4a           ;割る数をワークにコピー
0104   083A           00073                 movf    div2b,W
0105   00C2           00074                 movwf   div4b
0106   0839           00075                 movf    div2c,W
0107   00C1           00076                 movwf   div4c
0108   0838           00077                 movf    div2d,W
0109   00C0           00078                 movwf   div4d
010A                  00079 di3201
010A   0DC3           00080                 rlf             div4a,F         ;左シフトする
010B   0DC2           00081                 rlf             div4b,F
010C   0DC1           00082                 rlf             div4c,F
010D   0DC0           00083                 rlf             div4d,F
010E   1803           00084                 btfsc   STATUS,W                ;割る数の上位ビットが見付かったなら di3202 へ
010F   2915           00085                 goto    di3202
0110   0BC4           00086                 decfsz  divl1,F
0111   290A           00087                 goto    di3201
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0112   3001           00088                 movlw   H'01'
0113   00C6           00089                 movwf   diverr          ;割る数が０である、エラー終了
0114   0008           00090                 return
0115                  00091 di3202:
0115   01BF           00092                 clrf    div3a           ;答えのクリア
0116   01BE           00093                 clrf    div3b
0117   01BD           00094                 clrf    div3c
0118   01BC           00095                 clrf    div3d
0119   01C3           00096                 clrf    div4a           ;ワークのクリア
011A   01C2           00097                 clrf    div4b
011B   01C1           00098                 clrf    div4c
011C   01C0           00099                 clrf    div4d
011D   3020           00100                 movlw   H'20'           ;20h=32
011E   00C5           00101                 movwf   divl2
011F   0844           00102                 movf    divl1,W
0120   02C5           00103                 subwf   divl2,F         ;残り、実ループの回数
0121                  00104 di3203
0121   1003           00105                 bcf             STATUS,C                ;キャリフラグを０に
0122   0DB7           00106                 rlf             div1a,F         ;有効位置までシフトする
0123   0DB6           00107                 rlf             div1b,F
0124   0DB5           00108                 rlf             div1c,F
0125   0DB4           00109                 rlf             div1d,F
0126   0DC3           00110                 rlf             div4a,F         ;押し出されたビットをワークに
0127   0DC2           00111                 rlf             div4b,F
0128   0DC1           00112                 rlf             div4c,F
0129   0DC0           00113                 rlf             div4d,F
012A   0BC4           00114                 decfsz  divl1,F         ;割られる数を初期位置までシフトしておく
012B   2921           00115                 goto    di3203
012C                  00116 di3204
012C   0838           00117                 movf    div2d,W         ;div2c を w にコピー
012D   0240           00118                 subwf   div4d,W         ;比較
012E   1903           00119                 btfsc   STATUS,Z                ;結果が＝なら di3205 へ
012F   2934           00120                 goto    di3205
0130   1803           00121                 btfsc   STATUS,C                ;引くことが可なら di3210 へ
0131   294A           00122                 goto    di3210
0132   1C03           00123                 btfss   STATUS,C                ;引くことは不可なら di3211 へ
0133   2962           00124                 goto    di3211
0134                  00125 di3205:
0134   0839           00126                 movf    div2c,W
0135   0241           00127                 subwf   div4c,W
0136   1903           00128                 btfsc   STATUS,Z
0137   293C           00129                 goto    di3206
0138   1803           00130                 btfsc   STATUS,C
0139   294A           00131                 goto    di3210
013A   1C03           00132                 btfss   STATUS,C
013B   2962           00133                 goto    di3211
013C                  00134 di3206:
013C   083A           00135                 movf    div2b,W
013D   0242           00136                 subwf   div4b,W
013E   1903           00137                 btfsc   STATUS,Z
013F   2944           00138                 goto    di3207
0140   1803           00139                 btfsc   STATUS,C
0141   294A           00140                 goto    di3210
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0142   1C03           00141                 btfss   STATUS,C
0143   2962           00142                 goto    di3211
0144                  00143 di3207:
0144   083B           00144                 movf    div2a,W
0145   0243           00145                 subwf   div4a,W
0146   1903           00146                 btfsc   STATUS,Z
0147   294A           00147                 goto    di3210
0148   1C03           00148                 btfss   STATUS,C
0149   2962           00149                 goto    di3211
014A                  00150 di3210:
014A   083B           00151                 movf    div2a,W
014B   02C3           00152                 subwf   div4a,F         ;ワークから下位を引く
014C   3001           00153                 movlw   H'01'           ;ワークには余りが残る
014D   1C03           00154                 btfss   STATUS,C
014E   02C2           00155                 subwf   div4b,F
014F   1C03           00156                 btfss   STATUS,C
0150   02C1           00157                 subwf   div4c,F
0151   1C03           00158                 btfss   STATUS,C
0152   02C0           00159                 subwf   div4d,F
0153   083A           00160                 movf    div2b,W
0154   02C2           00161                 subwf   div4b,F         ;ワークから２位を引く
0155   3001           00162                 movlw   H'01'
0156   1C03           00163                 btfss   STATUS,C
0157   02C1           00164                 subwf   div4c,F
0158   1C03           00165                 btfss   STATUS,C
0159   02C0           00166                 subwf   div4d,F
015A   0839           00167                 movf    div2c,W
015B   02C1           00168                 subwf   div4c,F         ;ワークから３位を引く
015C   1C03           00169                 btfss   STATUS,W
015D   03C0           00170                 decf    div4d,F         ;４上位 -1
015E   0838           00171                 movf    div2d,W
015F   02C0           00172                 subwf   div4d,F         ;ワークから上位を引く
0160   1403           00173                 bsf             STATUS,C                ;キャリフラグを１に
0161   2963           00174                 goto    di3212
0162                  00175 di3211
0162   1003           00176                 bcf             STATUS,C                ;キャリフラグを０に
0163                  00177 di3212
0163   0DBF           00178                 rlf             div3a,F         ;キャリフラグの内容を答えにシフトしてゆく
0164   0DBE           00179                 rlf             div3b,F
0165   0DBD           00180                 rlf             div3c,F
0166   0DBC           00181                 rlf             div3d,F
0167   08C5           00182                 movf    divl2,F         ;divl2 が 0 か検査
0168   1903           00183                 btfsc   STATUS,Z
0169   2975           00184                 goto    di3213          ;最下位まで処理したなら終了
016A   03C5           00185                 decf    divl2,F         ;ビット位置を１つ下げる（右へ）
016B   1003           00186                 bcf             STATUS,C                ;キャリフラグを０に
016C   0DB7           00187                 rlf             div1a,F         ;ワークへ１ビット左シフト
016D   0DB6           00188                 rlf             div1b,F
016E   0DB5           00189                 rlf             div1c,F
016F   0DB4           00190                 rlf             div1d,F
0170   0DC3           00191                 rlf             div4a,F
0171   0DC2           00192                 rlf             div4b,F
0172   0DC1           00193                 rlf             div4c,F
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0173   0DC0           00194                 rlf             div4d,F
0174   292C           00195                 goto    di3204
0175                  00196 di3213
0175   01C6           00197                 clrf    diverr          ;正常終了
0176   0008           00198                 return
                      00199 
                      00200 
                      00201 ;*********************************************************************
                      00202 ;---------------------------------------------------------------------
                      00203 
                      00204                 ;結果はＢＣＤ数値（各下位４ビット）
                      00205 
                      00206 
0177                  00207 hexdec16        ;１６ビット（２バイト）数値を１０進数５桁のＢＣＤ値に変換する
                      00208                 ;引き数は prm1b(上位),prm1a(下位) の２バイト
                      00209                 ;結果は prm3e,prm3d,prm3c,prm3b,prm3a に得られ、右の prm3a が下位の数になる。
                      00210 
0177   304E           00211                 movlw   srlc1           ;格納場所初期値
0178   0084           00212                 movwf   4h              ;4h=fsr
0179   217F           00213                 call    devide          ;最下位変換
017A   217F           00214                 call    devide
017B   217F           00215                 call    devide
017C   217F           00216                 call    devide
017D   217F           00217                 call    devide          ;最上位変換
                      00218 
017E   0008           00219                 return
                      00220 
017F                  00221 devide                                  ;÷１０サブルーチン　（１０で除算）
017F   3010           00222                 movlw   d'16'           ;１６ビットくり返し
0180   00CE           00223                 movwf   srlc1
0181   01CF           00224                 clrf    srwk1
0182                  00225 devide0
0182   1003           00226                 bcf     3h,0            ;キャリフラグのクリア
0183   0DC8           00227                 rlf     prm1a,1
0184   0DC7           00228                 rlf     prm1b,1
0185   0DCF           00229                 rlf     srwk1,1
0186   30F6           00230                 movlw   b'11110110'
0187   074F           00231                 addwf   srwk1,0
0188   1803           00232                 btfsc   3h,0
0189   00CF           00233                 movwf   srwk1
018A   1803           00234                 btfsc   3h,0
018B   0AC8           00235                 incf    prm1a,1
018C   0BCE           00236                 decfsz  srlc1,1
018D   2982           00237                 goto    devide0
018E   0384           00238                 decf    4h,1            ;4h=fsr
018F   084F           00239                 movf    srwk1,0
0190   0080           00240                 movwf   0h              ;余り (0h=indirect)
                      00241 
0191   0008           00242                 return
                      00243 
                      00244 ;---------------------------------------------------------------------
                      00245 ;*********************************************************************
                      00246 
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00247 ;---------------------------------------------------------------------
                      00248 ;*********************************************************************
                      00282 
                      00283         end
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE 14


SYMBOL TABLE
  LABEL                             VALUE 

C                                 00000000
DC                                00000001
EEADR                             00000009
EECON1                            00000088
EECON2                            00000089
EEDATA                            00000008
EEIE                              00000006
EEIF                              00000004
F                                 00000001
FSR                               00000004
GIE                               00000007
GetLedPortA                       00000035
GetLedPortB                       00000040
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
IntRb0                            0000001B
IntSaveFsr                        0000000F
IntSavePclath                     0000000E
IntSaveStatus                     0000000D
IntSaveWreg                       0000000C
IntSkip                           0000001C
InterruptProc                     00000004
Led1                              0000001E
Led2                              0000001F
Led3                              00000020
Led4                              00000021
Led5                              00000022
LedDrive                          0000001F
LedPort                           0000001D
MainLoop                          00000088
NOT_PD                            00000003
NOT_RBPU                          00000007
NOT_TO                            00000004
OPTION_REG                        00000081
OldRpm1                           00000019
OldRpm2                           0000001A
OldTimer1                         00000014
PCL                               00000002
PCLATH                            0000000A
PORTA                             00000005
PORTB                             00000006
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PowerOnReset                      0000006D
RBIE                              00000003
RBIF                              00000000
RD                                00000000
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE 15


SYMBOL TABLE
  LABEL                             VALUE 

RP0                               00000005
RP1                               00000006
Rb0Interrupt                      00000052
STATUS                            00000003
Scan1                             00000015
Scan2                             00000016
Scan3                             00000017
Scan4                             00000018
SkipChataCheck                    000000A3
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
TMR0                              00000001
TRISA                             00000085
TRISB                             00000086
TempWreg                          0000004F
Timer1                            00000010
Timer2                            00000011
Timer3                            00000012
Timer4                            00000013
TimerAddEnd                       0000001D
TimerInterrupt                    00000018
W                                 00000000
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_CP_OFF                           00003FFF
_CP_ON                            0000000F
_HS_OSC                           00003FFE
_LP_OSC                           00003FFC
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_XT_OSC                           00003FFD
__16F84A                          00000001
add16ff                           
cmp16ff                           
cmpscc                            
cmpscs                            
cmpsnz                            
cmpsz                             
devide                            0000017F
devide0                           00000182
di3201                            0000010A
di3202                            00000115
di3203                            00000121
di3204                            0000012C
di3205                            00000134
di3206                            0000013C
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE 16


SYMBOL TABLE
  LABEL                             VALUE 

di3207                            00000144
di3210                            0000014A
di3211                            00000162
di3212                            00000163
di3213                            00000175
div1a                             00000037
div1b                             00000036
div1c                             00000035
div1d                             00000034
div2a                             0000003B
div2b                             0000003A
div2c                             00000039
div2d                             00000038
div32                             00000100
div3a                             0000003F
div3b                             0000003E
div3c                             0000003D
div3d                             0000003C
div4a                             00000043
div4b                             00000042
div4c                             00000041
div4d                             00000040
diverr                            00000046
divl1                             00000044
divl2                             00000045
hexdec16                          00000177
pcall                             
pgoto                             
prm1a                             00000048
prm1b                             00000047
prm3a                             0000004D
prm3b                             0000004C
prm3c                             0000004B
prm3d                             0000004A
prm3e                             00000049
srlc1                             0000004E
srwk1                             0000004F


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : X---XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXX---------
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
MPASM  5.11                          MAIN.ASM   7-17-2018  15:01:52         PAGE 17


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


0180 : XXXXXXXXXXXXXXXX XX-------------- ---------------- ----------------
2000 : -------X-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:   326
Program Memory Words Free:   698


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     1 reported,     3 suppressed

