MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;********************************************************
                      00002 ; RPM Counter
                      00003 ;********************************************************
                      00004 
                      00005         list            p=pic16f84a
                      00006         include         p16f84a.inc
                      00001         LIST
                      00002 ; P16F84A.INC  Standard Header File, Version 2.00    Microchip Technology, Inc.
                      00134         LIST
2007   3FF2           00007         __config _HS_OSC & _WDT_OFF & _PWRTE_ON & _CP_OFF
                      00008         errorlevel      -302    ;Eliminate bank warning
                      00009 
                      00010                 include                 macro.inc
                      00001 
                      00002 ;       Pic macro
                      00003 
  0000004F            00004 TempWreg        equ             h'4f'
                      00005 
                      00006 
                      00007 pcall   macro   Addr
                      00008                 movlw   high Addr
                      00009                 movwf   PCLATH
                      00010                 call    Addr
                      00011                 movlw   high $
                      00012                 movwf   PCLATH
                      00013                 endm
                      00014 
                      00015 pgoto   macro   Addr
                      00016                 movlw   high Addr
                      00017                 movwf   PCLATH
                      00018                 goto    Addr
                      00019                 endm
                      00020 
                      00021 ; Compre macro
                      00022 
                      00023 cmpsz   macro   val
                      00024                 movwf   TempWreg
                      00025                 sublw   val
                      00026                 swapf   TempWreg,F
                      00027                 swapf   TempWreg,W
                      00028                 btfss   STATUS,Z
                      00029                 endm
                      00030 
                      00031 cmpsnz  macro   val
                      00032                 movwf   TempWreg
                      00033                 sublw   val
                      00034                 swapf   TempWreg,F
                      00035                 swapf   TempWreg,W
                      00036                 btfsc   STATUS,Z
                      00037                 endm
                      00038 
                      00039 cmpscc  macro   val
                      00040                 movwf   TempWreg
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00041                 sublw   val
                      00042                 swapf   TempWreg,F
                      00043                 swapf   TempWreg,W
                      00044                 btfsc   STATUS,C
                      00045                 endm
                      00046 
                      00047 cmpscs  macro   val
                      00048                 movwf   TempWreg
                      00049                 sublw   val
                      00050                 swapf   TempWreg,F
                      00051                 swapf   TempWreg,W
                      00052                 btfss   STATUS,C
                      00053                 endm
                      00054 
                      00055 ;               movlw   H'12'
                      00056 ;               cmpsz   H'12'   ; Equal Skip
                      00057 ;               nop                             ; skip
                      00058 ;               cmpsnz  H'12'   ; Not Eaqual Skip
                      00059 ;               nop                             ; exec
                      00060 ;               cmpscc  H'1'    ; Wreg > k to Skip
                      00061 ;               nop                             ; skip
                      00062 ;               cmpscc  H'13' 
                      00063 ;               nop                             ; exec
                      00064 ;               cmpscs  H'1'    ; Wreg < k to Skip
                      00065 ;               nop                             ; exec
                      00066 ;               cmpscs  H'13'
                      00067 ;               nop                             ; skip
                      00068 
                      00069 
                      00070 add16ff macro   addfile1,addfile2,distfile
                      00071                 movf    addfile1,W
                      00072                 addwf   addfile2,W
                      00073                 movwf   distfile
                      00074                 movf    addfile1+1,W
                      00075                 btfsc   STATUS,C
                      00076                 incf    addfile1+1,W
                      00077                 addwf   addfile2+1,W
                      00078                 movwf   distfile+1
                      00079                 endm
                      00080 
                      00081 
                      00082 ; compfile1 smole equal big
                      00083 cmp16ff macro   compfile1,compfile2,AddrS,AddrE,AddrB
                      00084                 movf    compfile1+1,W
                      00085                 addlw   H'80'
                      00086                 movwf   TempWreg
                      00087                 movf    compfile2+1,W
                      00088                 addlw   H'80'
                      00089                 subwf   TempWreg,W
                      00090                 btfsc   STATUS,Z
                      00091                 goto    $+4
                      00092                 btfsc   STATUS,C
                      00093                 goto    AddrS
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00094                 goto    AddrB
                      00095                 movf    compfile2,W
                      00096                 subwf   compfile1,W
                      00097                 btfsc   STATUS,Z
                      00098                 goto    AddrE
                      00099                 btfsc   STATUS,C
                      00100                 goto    AddrS
                      00101                 goto    AddrB
                      00102                 endm
                      00103 
                      00104 
                      00105                 
                      00011 
                      00012 
                      00013 
                      00014 
                      00015 ;****************  Label Definition  ********************
                      00016 
                      00017 ;****************  SRAM define  ********************
                      00018                 cblock          h'0c'
  0000000C            00019 IntSaveWreg
  0000000D            00020 IntSaveStatus
  0000000E            00021 IntSavePclath
  0000000F            00022 IntSaveFsr
                      00023 
  00000010            00024 Timer1
  00000011            00025 Timer2
  00000012            00026 Timer3
  00000013            00027 Timer4
                      00028 
  00000014            00029 Scan1
  00000015            00030 Scan2
  00000016            00031 Scan3
  00000017            00032 Scan4
                      00033 
  00000018            00034 IntRb0
  00000019            00035 IntSkip
  0000001A            00036 LedPort
  0000001B            00037 Led1
  0000001C            00038 Led2
  0000001D            00039 Led3
  0000001E            00040 Led4
  0000001F            00041 Led5
                      00042 
  00000020            00043 rpm0_H
  00000021            00044 rpm0_L
  00000022            00045 rpm1_H
  00000023            00046 rpm1_L
  00000024            00047 rpm2_H
  00000025            00048 rpm2_L
  00000026            00049 rpm3_H
  00000027            00050 rpm3_L
  00000028            00051 work_H
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000029            00052 work_L
                      00053 
                      00054 
                      00055                 endc
                      00056 ;****************  Program Start  ***********************
0000                  00057         org     0               ;Reset Vector
0000   2869           00058         goto    PowerOnReset
0004                  00059         org     4               ;Interrupt Vector
                      00060 ;*************** Interrupt*************
0004                  00061 InterruptProc
0004   008C           00062                 movwf   IntSaveWreg
0005   0E03           00063                 swapf   STATUS,W
0006   008D           00064                 movwf   IntSaveStatus
0007   080A           00065                 movf    PCLATH,W
0008   008E           00066                 movwf   IntSavePclath
                      00067 
                      00068 ; Check Interrupt Flag
0009   190B           00069                 btfsc   INTCON,T0IF
000A   2015           00070                 call    TimerInterrupt
000B   188B           00071                 btfsc   INTCON,INTF
000C   2050           00072                 call    Rb0Interrupt
                      00073 
000D   0064           00074                 clrwdt                                          ;Clear watch dog timer and Prescaler
000E   080E           00075                 movf    IntSavePclath,W
000F   008A           00076                 movwf   PCLATH
0010   0E0D           00077                 swapf   IntSaveStatus,W
0011   0083           00078                 movwf   STATUS
0012   0E8C           00079                 swapf   IntSaveWreg,F
0013   0E0C           00080                 swapf   IntSaveWreg,W
0014   0009           00081                 retfie
                      00082 ;*************** TIMER INT Proc ******************
0015                  00083 TimerInterrupt
                      00084 
                      00085 ; Timer incliment (24Bit+TimerA)
0015   0F91           00086                 incfsz  Timer2,F
0016   281A           00087                 goto    TimerAddEnd
0017   0F92           00088                 incfsz  Timer3,F
0018   281A           00089                 goto    TimerAddEnd
0019   0A93           00090                 incf    Timer4,F
001A                  00091 TimerAddEnd
001A   201D           00092                 call    LedDrive
                      00093 
001B   110B           00094                 bcf             INTCON,T0IF
001C   0008           00095                 return
                      00096 ;*************** LED Drive Proc ********************
001D                  00097 LedDrive
001D   0B99           00098                 decfsz  IntSkip,F
001E   0008           00099                 return
                      00100 
001F   2033           00101                 call    GetLedPortA
0020   0085           00102                 movwf   PORTA
0021   0804           00103                 movf    FSR,W
0022   008F           00104                 movwf   IntSaveFsr
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0023   301B           00105                 movlw   Low Led1
0024   071A           00106                 addwf   LedPort,W
0025   0084           00107                 movwf   FSR
0026   0800           00108                 movf    INDF,W
0027   203E           00109                 call    GetLedPortB
0028   0086           00110                 movwf   PORTB
Message[305]: Using default destination of 1 (file).
0029   088F           00111                 movf    IntSaveFsr
002A   0084           00112                 movwf   FSR
                      00113 
002B   0A9A           00114                 incf    LedPort,F
002C   3005           00115                 movlw   H'05'
002D   021A           00116                 subwf   LedPort,W
002E   1903           00117                 btfsc   STATUS,Z
002F   019A           00118                 clrf    LedPort
                      00119 
0030   3005           00120                 movlw   H'05'
0031   0099           00121                 movwf   IntSkip
0032   0008           00122                 return
                      00123 
0033                  00124 GetLedPortA
0033   081A           00125                 movf    LedPort,W
0034   3907           00126                 andlw   H'07'
0035   0782           00127                 addwf   PCL,F
0036   3401           00128                 retlw   H'01'
0037   3402           00129                 retlw   H'02'
0038   3404           00130                 retlw   H'04'
0039   3408           00131                 retlw   H'08'
003A   3410           00132                 retlw   H'10'
003B   3400           00133                 retlw   H'00'
003C   3400           00134                 retlw   H'00'
003D   3400           00135                 retlw   H'00'
                      00136 
003E                  00137 GetLedPortB
003E   390F           00138                 andlw   H'0f'
003F   0782           00139                 addwf   PCL,F
0040   34BE           00140                 retlw   B'10111110'
0041   3430           00141                 retlw   B'00110000'
0042   34EC           00142                 retlw   B'11101100'
0043   34F8           00143                 retlw   B'11111000'
0044   3472           00144                 retlw   B'01110010'
0045   34DA           00145                 retlw   B'11011010'
0046   34DE           00146                 retlw   B'11011110'
0047   34B2           00147                 retlw   B'10110010'
0048   34FE           00148                 retlw   B'11111110'
0049   34FA           00149                 retlw   B'11111010'
004A   34F6           00150                 retlw   B'11110110'
004B   345E           00151                 retlw   B'01011110'
004C   348E           00152                 retlw   B'10001110'
004D   347C           00153                 retlw   B'01111100'
004E   34CE           00154                 retlw   B'11001110'
004F   34C6           00155                 retlw   B'11000110'
                      00156 
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00157 ;*************** RB0 INT Proc ********************
0050                  00158 Rb0Interrupt
                      00159 ;               btfss   INTCON,INTE                     ; RB0 Interrupt Enable check
                      00160 ;               return
                      00161 
0050   0801           00162                 movf    TMR0,W
0051   0090           00163                 movwf   Timer1
0052   0811           00164                 movf    Timer2,W
0053   0095           00165                 movwf   Scan2
0054   0812           00166                 movf    Timer3,W
0055   0096           00167                 movwf   Scan3
0056   0813           00168                 movf    Timer4,W
0057   0097           00169                 movwf   Scan4
                      00170 
0058   0191           00171                 clrf    Timer2
0059   0192           00172                 clrf    Timer3
005A   0193           00173                 clrf    Timer4
                      00174 
                      00175 
005B   3003           00176                 movlw   H'03'
005C   0210           00177                 subwf   Timer1,W
005D   0094           00178                 movwf   Scan1
005E   3001           00179                 movlw   H'01'
005F   1C03           00180                 btfss   STATUS,C
0060   0295           00181                 subwf   Scan2,F
0061   1C03           00182                 btfss   STATUS,C
0062   0296           00183                 subwf   Scan3,F
0063   1C03           00184                 btfss   STATUS,C
0064   0297           00185                 subwf   Scan4,F
                      00186 
0065   1418           00187                 bsf             IntRb0,0                        ; RB0 Interrupt Flag
0066   108B           00188                 bcf             INTCON,INTF                     ; Clear RB Int
0067   160B           00189                 bsf             INTCON,INTE                     ; RB0 Interrupt Enable
0068   0008           00190                 return
                      00191 ;****************  Initial Process  *********************
0069                  00192 PowerOnReset
0069   1683           00193                 bsf             STATUS,RP0                      ;Change to Bank1 
006A   0064           00194                 clrwdt                                          ;Clear watch dog timer and Prescaler
006B   3000           00195                 movlw   H'00'
006C   0085           00196                 movwf   TRISA                           ;Set PORTA All Output
006D   3001           00197                 movlw   H'01'
006E   0086           00198                 movwf   TRISB                           ;Set PORTB to Output/Input(Bit0) mode
006F   3001           00199                 movlw   H'01'
0070   0081           00200                 movwf   OPTION_REG                      ;RB Input Pull Up & PreScale 1/4
0071   1283           00201                 bcf             STATUS,RP0                      ;Change to Bank0
                      00202 
0072   3000           00203                 movlw   H'00'
0073   0081           00204                 movwf   TMR0                            ; TIMER0 Count Base Value
0074   160B           00205                 bsf             INTCON,INTE                     ; RB0 Interrupt Enable
0075   168B           00206                 bsf             INTCON,T0IE                     ; TIMER0 Interrupt Enable
0076   178B           00207                 bsf             INTCON,GIE                      ; General Interrupt Enable
                      00208 
0077   01A0           00209                 clrf    rpm0_H
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0078   01A1           00210                 clrf    rpm0_L
0079   01A2           00211                 clrf    rpm1_H
007A   01A3           00212                 clrf    rpm1_L
007B   01A4           00213                 clrf    rpm2_H
007C   01A5           00214                 clrf    rpm2_L
007D   01A6           00215                 clrf    rpm3_H
007E   01A7           00216                 clrf    rpm3_L
                      00217 
007F   0190           00218                 clrf    Timer1
0080   0191           00219                 clrf    Timer2
0081   0192           00220                 clrf    Timer3
0082   0193           00221                 clrf    Timer4
0083   300C           00222                 movlw   H'0c'
0084   0099           00223                 movwf   IntSkip
                      00224 
0085   0194           00225                 clrf    Scan1
0086   0195           00226                 clrf    Scan2
0087   0196           00227                 clrf    Scan3
0088   0197           00228                 clrf    Scan4
                      00229 
0089   0198           00230                 clrf    IntRb0
008A                  00231 MainLoop
008A   1C18           00232                 btfss   IntRb0,0
008B   288A           00233                 goto    MainLoop
008C   0198           00234                 clrf    IntRb0
                      00235 
008D   3004           00236                 movlw   H'04'           ; CPU clock(5MHz) prescale 1/4 * 60 (047868c0h=75000000)
008E   00B4           00237                 movwf   div1d
008F   3078           00238                 movlw   H'78'           ;
0090   00B5           00239                 movwf   div1c
0091   3068           00240                 movlw   H'68'           ;
0092   00B6           00241                 movwf   div1b
0093   30C0           00242                 movlw   H'c0'           ; LSB
0094   00B7           00243                 movwf   div1a
0095   0817           00244                 movf    Scan4,W         ; divider MSB       (Scan1-4)
0096   00B8           00245                 movwf   div2d
0097   0816           00246                 movf    Scan3,W         ;
0098   00B9           00247                 movwf   div2c
0099   0815           00248                 movf    Scan2,W         ;
009A   00BA           00249                 movwf   div2b
009B   0814           00250                 movf    Scan1,W         ; LSB
009C   00BB           00251                 movwf   div2a
009D   2100           00252                 call    div32           ; Anser -> div3d,c,b,a 縲《urplus div4d,c,b,a return
                      00253 
009E   083D           00254                 movf    div3c,W
009F   1D03           00255                 btfss   STATUS,Z
00A0   288A           00256                 goto    MainLoop        ; Chataring Cut ( over 65535RPM )
                      00257 
00A1   0824           00258                 movf    rpm2_H,W
00A2   00A6           00259                 movwf   rpm3_H
00A3   0825           00260                 movf    rpm2_L,W
00A4   00A7           00261                 movwf   rpm3_L
                      00262 
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00A5   0822           00263                 movf    rpm1_H,W
00A6   00A4           00264                 movwf   rpm2_H
00A7   0823           00265                 movf    rpm1_L,W
00A8   00A5           00266                 movwf   rpm2_L
                      00267 
00A9   0820           00268                 movf    rpm0_H,W
00AA   00A2           00269                 movwf   rpm1_H
00AB   0821           00270                 movf    rpm0_L,W
00AC   00A3           00271                 movwf   rpm1_L
                      00272 
00AD   083E           00273                 movf    div3b,W
00AE   00A0           00274                 movwf   rpm0_H
00AF   083F           00275                 movf    div3a,W
00B0   00A1           00276                 movwf   rpm0_L
                      00277         
00B1   3000           00278                 movlw   H'00'           ; work register clear
00B2   00A9           00279                 movwf   work_L
00B3   00A8           00280                 movwf   work_H
                      00281 
00B4   0821           00282                 movf    rpm0_L,W
00B5   0723           00283                 addwf   rpm1_L,W
00B6   00A9           00284                 movwf   work_L
00B7   1803           00285                 btfsc   STATUS,C
Message[305]: Using default destination of 1 (file).
00B8   0AA8           00286                 incf    work_H
00B9   0820           00287                 movf    rpm0_H,W
00BA   0722           00288                 addwf   rpm1_H,W
00BB   00A8           00289                 movwf   work_H
                      00290 
00BC   0829           00291                 movf    work_L,W
00BD   0725           00292                 addwf   rpm2_L,W
00BE   00A9           00293                 movwf   work_L
00BF   1803           00294                 btfsc   STATUS,C
Message[305]: Using default destination of 1 (file).
00C0   0AA8           00295                 incf    work_H
00C1   0828           00296                 movf    work_H,W
00C2   0724           00297                 addwf   rpm2_H,W
00C3   00A8           00298                 movwf   work_H
                      00299 
00C4   0829           00300                 movf    work_L,W
00C5   0727           00301                 addwf   rpm3_L,W
00C6   00A9           00302                 movwf   work_L
00C7   1803           00303                 btfsc   STATUS,C
Message[305]: Using default destination of 1 (file).
00C8   0AA8           00304                 incf    work_H
00C9   0828           00305                 movf    work_H,W
00CA   0726           00306                 addwf   rpm3_H,W
00CB   00A8           00307                 movwf   work_H
                      00308 
00CC   1003           00309                 bcf             STATUS,C
00CD   0CA8           00310                 rrf             work_H,F
00CE   0CA9           00311                 rrf             work_L,F
00CF   1003           00312                 bcf             STATUS,C
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00D0   0CA8           00313                 rrf             work_H,F
00D1   0CA9           00314                 rrf             work_L,F
                      00315 
00D2   0828           00316                 movf    work_H,W
00D3   00C7           00317                 movwf   prm1b
00D4   0829           00318                 movf    work_L,W
00D5   00C8           00319                 movwf   prm1a
00D6   2177           00320                 call    hexdec16
                      00321 
                      00322 ;       7SEG. 5Column version
                      00323 ;               movf    prm3e,W
                      00324 ;               movwf   Led1
                      00325 ;               movf    prm3d,W
                      00326 ;               movwf   Led2
                      00327 ;               movf    prm3c,W
                      00328 ;               movwf   Led3
                      00329 ;               movf    prm3b,W
                      00330 ;               movwf   Led4
                      00331 ;               movf    prm3a,W
                      00332 ;               movwf   Led5
                      00333 
                      00334 
                      00335 ;       7SEG. 4Column version
00D7   084A           00336                 movf    prm3d,W
00D8   009B           00337                 movwf   Led1
00D9   084B           00338                 movf    prm3c,W
00DA   009C           00339                 movwf   Led2
00DB   084C           00340                 movf    prm3b,W
00DC   009D           00341                 movwf   Led3
00DD   084D           00342                 movf    prm3a,W
00DE   009E           00343                 movwf   Led4
00DF   288A           00344                 goto    MainLoop
                      00345 
                      00346 
                      00347                 include                 math.inc
                      00001 ;****************  SRAM define  ********************
                      00002                 cblock  H'34'
  00000034            00003 div1d                           ;割られる数上位　（終了時には０になる）
  00000035            00004 div1c                           ; 〜
  00000036            00005 div1b                           ; 〜
  00000037            00006 div1a                           ;下位
  00000038            00007 div2d                           ;割る数上位       (変化せず戻る）
  00000039            00008 div2c                           ; 〜
  0000003A            00009 div2b                           ; 〜
  0000003B            00010 div2a                           ;下位
  0000003C            00011 div3d                           ;答え上位　　　　（答えが返る）
  0000003D            00012 div3c                           ; 〜
  0000003E            00013 div3b                           ; 〜
  0000003F            00014 div3a                           ;下位
  00000040            00015 div4d                           ;余り上位　　　　（余りが返る、内部ワークにも使用）
  00000041            00016 div4c                           ; 〜
  00000042            00017 div4b                           ; 〜
  00000043            00018 div4a                           ;余り下位
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000044            00019 divl1                           ;内部ループ用
  00000045            00020 divl2                           ;内部ループ用
  00000046            00021 diverr                          ;割る数が０であった場合に１をセットして戻る
                      00022 
  00000047            00023 prm1b                           ; 変換したい値（１６ビット。変換後は壊れる）
  00000048            00024 prm1a                           ;〜下位
  00000049            00025 prm3e                           ;10進格納場所（５バイト）
  0000004A            00026 prm3d           
  0000004B            00027 prm3c           
  0000004C            00028 prm3b           
  0000004D            00029 prm3a                           ;〜下位
  0000004E            00030 srlc1                           ; カウンタ（サブルーチンで使用）
  0000004F            00031 srwk1                           ; 一時余り格納場所（サブルーチンで使用）
                      00032 
                      00033                 endc
                      00034 
                      00035 
0100                  00036                 org             H'100'
                      00037 
                      00038 
                      00039 ;               movlw   0ffh            ;割られる数上位  (ffffffffh=4294967295)
                      00040 ;               movwf   div1d
                      00041 ;               movlw   0ffh            ; 〜
                      00042 ;               movwf   div1c
                      00043 ;               movlw   0ffh            ; 〜
                      00044 ;               movwf   div1b
                      00045 ;               movlw   0ffh            ;下位
                      00046 ;               movwf   div1a
                      00047 
                      00048 ;               movlw   00h             ;割る数上位       (989680h=10000000)
                      00049 ;               movwf   div2d
                      00050 ;               movlw   098h            ; 〜
                      00051 ;               movwf   div2c
                      00052 ;               movlw   096h            ; 〜
                      00053 ;               movwf   div2b
                      00054 ;               movlw   080h            ;下位
                      00055 ;               movwf   div2a
                      00056 
                      00057 ;               call    div32           ;答えは div3d,c,b,a 、余りは div4d,c,b,a に返る
                      00058 
                      00059 ;*********************************************************************
                      00060 ;---------------------------------------------------------------------
                      00061 
0100                  00062 div32           ;３２÷３２ビット＝３２ビットの割り算ルーチン
                      00063                 ;div1d,c,b,a ÷ div2d,c,b,a ＝ 結果 div3d,c,b,a  余り div4d,c,b,a
                      00064                 ;演算後、式の左項（割られる数）は壊れる
                      00065                 ;割る数が０（エラー）なら diverr に１を代入して戻る
                      00066                 ;エラーの場合、引き数は変化しない
                      00067                 ;正常終了の場合は diverr=0 で戻る
                      00068                 ;32ビットで扱える数の最大は 4294967295　(42億9496万7295)
0100   3020           00069                 movlw   H'20'           ;20h=32
0101   00C4           00070                 movwf   divl1
0102   083B           00071                 movf    div2a,W
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0103   00C3           00072                 movwf   div4a           ;割る数をワークにコピー
0104   083A           00073                 movf    div2b,W
0105   00C2           00074                 movwf   div4b
0106   0839           00075                 movf    div2c,W
0107   00C1           00076                 movwf   div4c
0108   0838           00077                 movf    div2d,W
0109   00C0           00078                 movwf   div4d
010A                  00079 di3201
010A   0DC3           00080                 rlf             div4a,F         ;左シフトする
010B   0DC2           00081                 rlf             div4b,F
010C   0DC1           00082                 rlf             div4c,F
010D   0DC0           00083                 rlf             div4d,F
010E   1803           00084                 btfsc   STATUS,W                ;割る数の上位ビットが見付かったなら di3202 へ
010F   2915           00085                 goto    di3202
0110   0BC4           00086                 decfsz  divl1,F
0111   290A           00087                 goto    di3201
0112   3001           00088                 movlw   H'01'
0113   00C6           00089                 movwf   diverr          ;割る数が０である、エラー終了
0114   0008           00090                 return
0115                  00091 di3202:
0115   01BF           00092                 clrf    div3a           ;答えのクリア
0116   01BE           00093                 clrf    div3b
0117   01BD           00094                 clrf    div3c
0118   01BC           00095                 clrf    div3d
0119   01C3           00096                 clrf    div4a           ;ワークのクリア
011A   01C2           00097                 clrf    div4b
011B   01C1           00098                 clrf    div4c
011C   01C0           00099                 clrf    div4d
011D   3020           00100                 movlw   H'20'           ;20h=32
011E   00C5           00101                 movwf   divl2
011F   0844           00102                 movf    divl1,W
0120   02C5           00103                 subwf   divl2,F         ;残り、実ループの回数
0121                  00104 di3203
0121   1003           00105                 bcf             STATUS,C                ;キャリフラグを０に
0122   0DB7           00106                 rlf             div1a,F         ;有効位置までシフトする
0123   0DB6           00107                 rlf             div1b,F
0124   0DB5           00108                 rlf             div1c,F
0125   0DB4           00109                 rlf             div1d,F
0126   0DC3           00110                 rlf             div4a,F         ;押し出されたビットをワークに
0127   0DC2           00111                 rlf             div4b,F
0128   0DC1           00112                 rlf             div4c,F
0129   0DC0           00113                 rlf             div4d,F
012A   0BC4           00114                 decfsz  divl1,F         ;割られる数を初期位置までシフトしておく
012B   2921           00115                 goto    di3203
012C                  00116 di3204
012C   0838           00117                 movf    div2d,W         ;div2c を w にコピー
012D   0240           00118                 subwf   div4d,W         ;比較
012E   1903           00119                 btfsc   STATUS,Z                ;結果が＝なら di3205 へ
012F   2934           00120                 goto    di3205
0130   1803           00121                 btfsc   STATUS,C                ;引くことが可なら di3210 へ
0131   294A           00122                 goto    di3210
0132   1C03           00123                 btfss   STATUS,C                ;引くことは不可なら di3211 へ
0133   2962           00124                 goto    di3211
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0134                  00125 di3205:
0134   0839           00126                 movf    div2c,W
0135   0241           00127                 subwf   div4c,W
0136   1903           00128                 btfsc   STATUS,Z
0137   293C           00129                 goto    di3206
0138   1803           00130                 btfsc   STATUS,C
0139   294A           00131                 goto    di3210
013A   1C03           00132                 btfss   STATUS,C
013B   2962           00133                 goto    di3211
013C                  00134 di3206:
013C   083A           00135                 movf    div2b,W
013D   0242           00136                 subwf   div4b,W
013E   1903           00137                 btfsc   STATUS,Z
013F   2944           00138                 goto    di3207
0140   1803           00139                 btfsc   STATUS,C
0141   294A           00140                 goto    di3210
0142   1C03           00141                 btfss   STATUS,C
0143   2962           00142                 goto    di3211
0144                  00143 di3207:
0144   083B           00144                 movf    div2a,W
0145   0243           00145                 subwf   div4a,W
0146   1903           00146                 btfsc   STATUS,Z
0147   294A           00147                 goto    di3210
0148   1C03           00148                 btfss   STATUS,C
0149   2962           00149                 goto    di3211
014A                  00150 di3210:
014A   083B           00151                 movf    div2a,W
014B   02C3           00152                 subwf   div4a,F         ;ワークから下位を引く
014C   3001           00153                 movlw   H'01'           ;ワークには余りが残る
014D   1C03           00154                 btfss   STATUS,C
014E   02C2           00155                 subwf   div4b,F
014F   1C03           00156                 btfss   STATUS,C
0150   02C1           00157                 subwf   div4c,F
0151   1C03           00158                 btfss   STATUS,C
0152   02C0           00159                 subwf   div4d,F
0153   083A           00160                 movf    div2b,W
0154   02C2           00161                 subwf   div4b,F         ;ワークから２位を引く
0155   3001           00162                 movlw   H'01'
0156   1C03           00163                 btfss   STATUS,C
0157   02C1           00164                 subwf   div4c,F
0158   1C03           00165                 btfss   STATUS,C
0159   02C0           00166                 subwf   div4d,F
015A   0839           00167                 movf    div2c,W
015B   02C1           00168                 subwf   div4c,F         ;ワークから３位を引く
015C   1C03           00169                 btfss   STATUS,W
015D   03C0           00170                 decf    div4d,F         ;４上位 -1
015E   0838           00171                 movf    div2d,W
015F   02C0           00172                 subwf   div4d,F         ;ワークから上位を引く
0160   1403           00173                 bsf             STATUS,C                ;キャリフラグを１に
0161   2963           00174                 goto    di3212
0162                  00175 di3211
0162   1003           00176                 bcf             STATUS,C                ;キャリフラグを０に
0163                  00177 di3212
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0163   0DBF           00178                 rlf             div3a,F         ;キャリフラグの内容を答えにシフトしてゆく
0164   0DBE           00179                 rlf             div3b,F
0165   0DBD           00180                 rlf             div3c,F
0166   0DBC           00181                 rlf             div3d,F
0167   08C5           00182                 movf    divl2,F         ;divl2 が 0 か検査
0168   1903           00183                 btfsc   STATUS,Z
0169   2975           00184                 goto    di3213          ;最下位まで処理したなら終了
016A   03C5           00185                 decf    divl2,F         ;ビット位置を１つ下げる（右へ）
016B   1003           00186                 bcf             STATUS,C                ;キャリフラグを０に
016C   0DB7           00187                 rlf             div1a,F         ;ワークへ１ビット左シフト
016D   0DB6           00188                 rlf             div1b,F
016E   0DB5           00189                 rlf             div1c,F
016F   0DB4           00190                 rlf             div1d,F
0170   0DC3           00191                 rlf             div4a,F
0171   0DC2           00192                 rlf             div4b,F
0172   0DC1           00193                 rlf             div4c,F
0173   0DC0           00194                 rlf             div4d,F
0174   292C           00195                 goto    di3204
0175                  00196 di3213
0175   01C6           00197                 clrf    diverr          ;正常終了
0176   0008           00198                 return
                      00199 
                      00200 
                      00201 ;*********************************************************************
                      00202 ;---------------------------------------------------------------------
                      00203 
                      00204                 ;結果はＢＣＤ数値（各下位４ビット）
                      00205 
                      00206 
0177                  00207 hexdec16        ;１６ビット（２バイト）数値を１０進数５桁のＢＣＤ値に変換する
                      00208                 ;引き数は prm1b(上位),prm1a(下位) の２バイト
                      00209                 ;結果は prm3e,prm3d,prm3c,prm3b,prm3a に得られ、右の prm3a が下位の数になる。
                      00210 
0177   304E           00211                 movlw   srlc1           ;格納場所初期値
0178   0084           00212                 movwf   4h              ;4h=fsr
0179   217F           00213                 call    devide          ;最下位変換
017A   217F           00214                 call    devide
017B   217F           00215                 call    devide
017C   217F           00216                 call    devide
017D   217F           00217                 call    devide          ;最上位変換
                      00218 
017E   0008           00219                 return
                      00220 
017F                  00221 devide                                  ;÷１０サブルーチン　（１０で除算）
017F   3010           00222                 movlw   d'16'           ;１６ビットくり返し
0180   00CE           00223                 movwf   srlc1
0181   01CF           00224                 clrf    srwk1
0182                  00225 devide0
0182   1003           00226                 bcf     3h,0            ;キャリフラグのクリア
0183   0DC8           00227                 rlf     prm1a,1
0184   0DC7           00228                 rlf     prm1b,1
0185   0DCF           00229                 rlf     srwk1,1
0186   30F6           00230                 movlw   b'11110110'
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0187   074F           00231                 addwf   srwk1,0
0188   1803           00232                 btfsc   3h,0
0189   00CF           00233                 movwf   srwk1
018A   1803           00234                 btfsc   3h,0
018B   0AC8           00235                 incf    prm1a,1
018C   0BCE           00236                 decfsz  srlc1,1
018D   2982           00237                 goto    devide0
018E   0384           00238                 decf    4h,1            ;4h=fsr
018F   084F           00239                 movf    srwk1,0
0190   0080           00240                 movwf   0h              ;余り (0h=indirect)
                      00241 
0191   0008           00242                 return
                      00243 
                      00244 ;---------------------------------------------------------------------
                      00245 ;*********************************************************************
                      00246 
                      00247 ;---------------------------------------------------------------------
                      00248 ;*********************************************************************
                      00348 
                      00349         end
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE 15


SYMBOL TABLE
  LABEL                             VALUE 

C                                 00000000
DC                                00000001
EEADR                             00000009
EECON1                            00000088
EECON2                            00000089
EEDATA                            00000008
EEIE                              00000006
EEIF                              00000004
F                                 00000001
FSR                               00000004
GIE                               00000007
GetLedPortA                       00000033
GetLedPortB                       0000003E
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
IntRb0                            00000018
IntSaveFsr                        0000000F
IntSavePclath                     0000000E
IntSaveStatus                     0000000D
IntSaveWreg                       0000000C
IntSkip                           00000019
InterruptProc                     00000004
Led1                              0000001B
Led2                              0000001C
Led3                              0000001D
Led4                              0000001E
Led5                              0000001F
LedDrive                          0000001D
LedPort                           0000001A
MainLoop                          0000008A
NOT_PD                            00000003
NOT_RBPU                          00000007
NOT_TO                            00000004
OPTION_REG                        00000081
PCL                               00000002
PCLATH                            0000000A
PORTA                             00000005
PORTB                             00000006
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PowerOnReset                      00000069
RBIE                              00000003
RBIF                              00000000
RD                                00000000
RP0                               00000005
RP1                               00000006
Rb0Interrupt                      00000050
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE 16


SYMBOL TABLE
  LABEL                             VALUE 

STATUS                            00000003
Scan1                             00000014
Scan2                             00000015
Scan3                             00000016
Scan4                             00000017
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
TMR0                              00000001
TRISA                             00000085
TRISB                             00000086
TempWreg                          0000004F
Timer1                            00000010
Timer2                            00000011
Timer3                            00000012
Timer4                            00000013
TimerAddEnd                       0000001A
TimerInterrupt                    00000015
W                                 00000000
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_CP_OFF                           00003FFF
_CP_ON                            0000000F
_HS_OSC                           00003FFE
_LP_OSC                           00003FFC
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_XT_OSC                           00003FFD
__16F84A                          00000001
add16ff                           
cmp16ff                           
cmpscc                            
cmpscs                            
cmpsnz                            
cmpsz                             
devide                            0000017F
devide0                           00000182
di3201                            0000010A
di3202                            00000115
di3203                            00000121
di3204                            0000012C
di3205                            00000134
di3206                            0000013C
di3207                            00000144
di3210                            0000014A
di3211                            00000162
di3212                            00000163
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE 17


SYMBOL TABLE
  LABEL                             VALUE 

di3213                            00000175
div1a                             00000037
div1b                             00000036
div1c                             00000035
div1d                             00000034
div2a                             0000003B
div2b                             0000003A
div2c                             00000039
div2d                             00000038
div32                             00000100
div3a                             0000003F
div3b                             0000003E
div3c                             0000003D
div3d                             0000003C
div4a                             00000043
div4b                             00000042
div4c                             00000041
div4d                             00000040
diverr                            00000046
divl1                             00000044
divl2                             00000045
hexdec16                          00000177
pcall                             
pgoto                             
prm1a                             00000048
prm1b                             00000047
prm3a                             0000004D
prm3b                             0000004C
prm3c                             0000004B
prm3d                             0000004A
prm3e                             00000049
rpm0_H                            00000020
rpm0_L                            00000021
rpm1_H                            00000022
rpm1_L                            00000023
rpm2_H                            00000024
rpm2_L                            00000025
rpm3_H                            00000026
rpm3_L                            00000027
srlc1                             0000004E
srwk1                             0000004F
work_H                            00000028
work_L                            00000029
MPASM  5.11                          MAIN.ASM   7-23-2018  17:42:39         PAGE 18


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


0000 : X---XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX ---------------- ----------------
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0180 : XXXXXXXXXXXXXXXX XX-------------- ---------------- ----------------
2000 : -------X-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:   367
Program Memory Words Free:   657


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     4 reported,     3 suppressed

