MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;********************************************************
                      00002 ; RPM Counter
                      00003 ;********************************************************
                      00004 
                      00005         list            p=pic16f84a
                      00006         include         p16f84a.inc
                      00001         LIST
                      00002 ; P16F84A.INC  Standard Header File, Version 2.00    Microchip Technology, Inc.
                      00134         LIST
2007   3FF2           00007         __config _HS_OSC & _WDT_OFF & _PWRTE_ON & _CP_OFF
                      00008         errorlevel      -302    ;Eliminate bank warning
                      00009 
                      00010                 include                 macro.inc
                      00001 
                      00002 ;       Pic macro
                      00003 
  0000004F            00004 TempWreg        equ             h'4f'
                      00005 
                      00006 
                      00007 pcall   macro   Addr
                      00008                 movlw   high Addr
                      00009                 movwf   PCLATH
                      00010                 call    Addr
                      00011                 movlw   high $
                      00012                 movwf   PCLATH
                      00013                 endm
                      00014 
                      00015 pgoto   macro   Addr
                      00016                 movlw   high Addr
                      00017                 movwf   PCLATH
                      00018                 goto    Addr
                      00019                 endm
                      00020 
                      00021 ; Compre macro
                      00022 
                      00023 cmpsz   macro   val
                      00024                 movwf   TempWreg
                      00025                 sublw   val
                      00026                 swapf   TempWreg,F
                      00027                 swapf   TempWreg,W
                      00028                 btfss   STATUS,Z
                      00029                 endm
                      00030 
                      00031 cmpsnz  macro   val
                      00032                 movwf   TempWreg
                      00033                 sublw   val
                      00034                 swapf   TempWreg,F
                      00035                 swapf   TempWreg,W
                      00036                 btfsc   STATUS,Z
                      00037                 endm
                      00038 
                      00039 cmpscc  macro   val
                      00040                 movwf   TempWreg
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00041                 sublw   val
                      00042                 swapf   TempWreg,F
                      00043                 swapf   TempWreg,W
                      00044                 btfsc   STATUS,C
                      00045                 endm
                      00046 
                      00047 cmpscs  macro   val
                      00048                 movwf   TempWreg
                      00049                 sublw   val
                      00050                 swapf   TempWreg,F
                      00051                 swapf   TempWreg,W
                      00052                 btfss   STATUS,C
                      00053                 endm
                      00054 
                      00055 ;               movlw   H'12'
                      00056 ;               cmpsz   H'12'   ; Equal Skip
                      00057 ;               nop                             ; skip
                      00058 ;               cmpsnz  H'12'   ; Not Eaqual Skip
                      00059 ;               nop                             ; exec
                      00060 ;               cmpscc  H'1'    ; Wreg > k to Skip
                      00061 ;               nop                             ; skip
                      00062 ;               cmpscc  H'13' 
                      00063 ;               nop                             ; exec
                      00064 ;               cmpscs  H'1'    ; Wreg < k to Skip
                      00065 ;               nop                             ; exec
                      00066 ;               cmpscs  H'13'
                      00067 ;               nop                             ; skip
                      00068 
                      00069 
                      00070 add16ff macro   addfile1,addfile2,distfile
                      00071                 movf    addfile1,W
                      00072                 addwf   addfile2,W
                      00073                 movwf   distfile
                      00074                 movf    addfile1+1,W
                      00075                 btfsc   STATUS,C
                      00076                 incf    addfile1+1,W
                      00077                 addwf   addfile2+1,W
                      00078                 movwf   distfile+1
                      00079                 endm
                      00080 
                      00081 
                      00082 ; compfile1 smole equal big
                      00083 cmp16ff macro   compfile1,compfile2,AddrS,AddrE,AddrB
                      00084                 movf    compfile1+1,W
                      00085                 addlw   H'80'
                      00086                 movwf   TempWreg
                      00087                 movf    compfile2+1,W
                      00088                 addlw   H'80'
                      00089                 subwf   TempWreg,W
                      00090                 btfsc   STATUS,Z
                      00091                 goto    $+4
                      00092                 btfsc   STATUS,C
                      00093                 goto    AddrS
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00094                 goto    AddrB
                      00095                 movf    compfile2,W
                      00096                 subwf   compfile1,W
                      00097                 btfsc   STATUS,Z
                      00098                 goto    AddrE
                      00099                 btfsc   STATUS,C
                      00100                 goto    AddrS
                      00101                 goto    AddrB
                      00102                 endm
                      00103 
                      00104 
                      00105                 
                      00011 
                      00012 
                      00013 
                      00014 
                      00015 ;****************  Label Definition  ********************
                      00016 
                      00017 ;****************  SRAM define  ********************
                      00018                 cblock          h'0c'
  0000000C            00019 IntSaveWreg
  0000000D            00020 IntSaveStatus
  0000000E            00021 IntSavePclath
  0000000F            00022 IntSaveFsr
                      00023 
  00000010            00024 Timer1
  00000011            00025 Timer2
  00000012            00026 Timer3
  00000013            00027 Timer4
                      00028 
  00000014            00029 OldTimer1
                      00030 
  00000015            00031 Scan1
  00000016            00032 Scan2
  00000017            00033 Scan3
  00000018            00034 Scan4
                      00035 
  00000019            00036 OldRpm1
  0000001A            00037 OldRpm2
                      00038 
  0000001B            00039 IntRb0
  0000001C            00040 IntSkip
  0000001D            00041 LedPort
  0000001E            00042 Led1
  0000001F            00043 Led2
  00000020            00044 Led3
  00000021            00045 Led4
  00000022            00046 Led5
                      00047 
  00000023            00048 rpm0_H
  00000024            00049 rpm0_L
  00000025            00050 rpm1_H
  00000026            00051 rpm1_L
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000027            00052 rpm2_H
  00000028            00053 rpm2_L
  00000029            00054 rpm3_H
  0000002A            00055 rpm3_L
  0000002B            00056 work_H
  0000002C            00057 work_L
                      00058 
                      00059 
                      00060                 endc
                      00061 ;****************  Program Start  ***********************
0000                  00062         org     0               ;Reset Vector
0000   286C           00063         goto    PowerOnReset
0004                  00064         org     4               ;Interrupt Vector
                      00065 ;*************** Interrupt*************
0004                  00066 InterruptProc
0004   008C           00067                 movwf   IntSaveWreg
0005   0E03           00068                 swapf   STATUS,W
0006   008D           00069                 movwf   IntSaveStatus
0007   080A           00070                 movf    PCLATH,W
0008   008E           00071                 movwf   IntSavePclath
                      00072 
                      00073 ; Check Interrupt Flag
0009   190B           00074                 btfsc   INTCON,T0IF
000A   2015           00075                 call    TimerInterrupt
000B   188B           00076                 btfsc   INTCON,INTF
000C   2050           00077                 call    Rb0Interrupt
                      00078 
000D   0064           00079                 clrwdt                                          ;Clear watch dog timer and Prescaler
000E   080E           00080                 movf    IntSavePclath,W
000F   008A           00081                 movwf   PCLATH
0010   0E0D           00082                 swapf   IntSaveStatus,W
0011   0083           00083                 movwf   STATUS
0012   0E8C           00084                 swapf   IntSaveWreg,F
0013   0E0C           00085                 swapf   IntSaveWreg,W
0014   0009           00086                 retfie
                      00087 ;*************** TIMER INT Proc ******************
0015                  00088 TimerInterrupt
                      00089 
                      00090 ; Timer incliment (24Bit+TimerA)
0015   0F91           00091                 incfsz  Timer2,F
0016   281A           00092                 goto    TimerAddEnd
0017   0F92           00093                 incfsz  Timer3,F
0018   281A           00094                 goto    TimerAddEnd
0019   0A93           00095                 incf    Timer4,F
001A                  00096 TimerAddEnd
001A   201D           00097                 call    LedDrive
                      00098 
001B   110B           00099                 bcf             INTCON,T0IF
001C   0008           00100                 return
                      00101 ;*************** LED Drive Proc ********************
001D                  00102 LedDrive
001D   0B9C           00103                 decfsz  IntSkip,F
001E   0008           00104                 return
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00105 
001F   2033           00106                 call    GetLedPortA
0020   0085           00107                 movwf   PORTA
0021   0804           00108                 movf    FSR,W
0022   008F           00109                 movwf   IntSaveFsr
0023   301E           00110                 movlw   Low Led1
0024   071D           00111                 addwf   LedPort,W
0025   0084           00112                 movwf   FSR
0026   0800           00113                 movf    INDF,W
0027   203E           00114                 call    GetLedPortB
0028   0086           00115                 movwf   PORTB
Message[305]: Using default destination of 1 (file).
0029   088F           00116                 movf    IntSaveFsr
002A   0084           00117                 movwf   FSR
                      00118 
002B   0A9D           00119                 incf    LedPort,F
002C   3005           00120                 movlw   H'05'
002D   021D           00121                 subwf   LedPort,W
002E   1903           00122                 btfsc   STATUS,Z
002F   019D           00123                 clrf    LedPort
                      00124 
0030   3005           00125                 movlw   H'05'
0031   009C           00126                 movwf   IntSkip
0032   0008           00127                 return
                      00128 
0033                  00129 GetLedPortA
0033   081D           00130                 movf    LedPort,W
0034   3907           00131                 andlw   H'07'
0035   0782           00132                 addwf   PCL,F
0036   3401           00133                 retlw   H'01'
0037   3402           00134                 retlw   H'02'
0038   3404           00135                 retlw   H'04'
0039   3408           00136                 retlw   H'08'
003A   3410           00137                 retlw   H'10'
003B   3400           00138                 retlw   H'00'
003C   3400           00139                 retlw   H'00'
003D   3400           00140                 retlw   H'00'
                      00141 
003E                  00142 GetLedPortB
003E   390F           00143                 andlw   H'0f'
003F   0782           00144                 addwf   PCL,F
0040   34BE           00145                 retlw   B'10111110'
0041   3430           00146                 retlw   B'00110000'
0042   34EC           00147                 retlw   B'11101100'
0043   34F8           00148                 retlw   B'11111000'
0044   3472           00149                 retlw   B'01110010'
0045   34DA           00150                 retlw   B'11011010'
0046   34DE           00151                 retlw   B'11011110'
0047   34B2           00152                 retlw   B'10110010'
0048   34FE           00153                 retlw   B'11111110'
0049   34FA           00154                 retlw   B'11111010'
004A   34F6           00155                 retlw   B'11110110'
004B   345E           00156                 retlw   B'01011110'
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

004C   348E           00157                 retlw   B'10001110'
004D   347C           00158                 retlw   B'01111100'
004E   34CE           00159                 retlw   B'11001110'
004F   34C6           00160                 retlw   B'11000110'
                      00161 
                      00162 ;*************** RB0 INT Proc ********************
0050                  00163 Rb0Interrupt
                      00164 ;               btfss   INTCON,INTE                     ; RB0 Interrupt Enable check
                      00165 ;               return
                      00166 
0050   0801           00167                 movf    TMR0,W
0051   3CFD           00168                 sublw   H'fd'
0052   0090           00169                 movwf   Timer1
0053   0811           00170                 movf    Timer2,W
0054   0096           00171                 movwf   Scan2
0055   0812           00172                 movf    Timer3,W
0056   0097           00173                 movwf   Scan3
0057   0813           00174                 movf    Timer4,W
0058   0098           00175                 movwf   Scan4
                      00176 
0059   0191           00177                 clrf    Timer2
005A   0192           00178                 clrf    Timer3
005B   0193           00179                 clrf    Timer4
                      00180 
                      00181 
005C   0814           00182                 movf    OldTimer1,W                     ; Lead Timer Adjustment
005D   0210           00183                 subwf   Timer1,W
005E   0095           00184                 movwf   Scan1
005F   3001           00185                 movlw   H'01'
0060   1C03           00186                 btfss   STATUS,C
0061   0296           00187                 subwf   Scan2,F
0062   1C03           00188                 btfss   STATUS,C
0063   0297           00189                 subwf   Scan3,F
0064   1C03           00190                 btfss   STATUS,C
0065   0298           00191                 subwf   Scan4,F
                      00192 
0066   0810           00193                 movf    Timer1,W
0067   0094           00194                 movwf   OldTimer1
                      00195 
0068   141B           00196                 bsf             IntRb0,0                        ; RB0 Interrupt Flag
0069   108B           00197                 bcf             INTCON,INTF                     ; Clear RB Int
006A   160B           00198                 bsf             INTCON,INTE                     ; RB0 Interrupt Enable
006B   0008           00199                 return
                      00200 ;****************  Initial Process  *********************
006C                  00201 PowerOnReset
006C   1683           00202                 bsf             STATUS,RP0                      ;Change to Bank1 
006D   0064           00203                 clrwdt                                          ;Clear watch dog timer and Prescaler
006E   3000           00204                 movlw   H'00'
006F   0085           00205                 movwf   TRISA                           ;Set PORTA All Output
0070   3001           00206                 movlw   H'01'
0071   0086           00207                 movwf   TRISB                           ;Set PORTB to Output/Input(Bit0) mode
0072   3001           00208                 movlw   H'01'
0073   0081           00209                 movwf   OPTION_REG                      ;RB Input Pull Up & PreScale 1/4
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0074   1283           00210                 bcf             STATUS,RP0                      ;Change to Bank0
                      00211 
0075   3000           00212                 movlw   H'00'
0076   0081           00213                 movwf   TMR0                            ; TIMER0 Count Base Value
0077   160B           00214                 bsf             INTCON,INTE                     ; RB0 Interrupt Enable
0078   168B           00215                 bsf             INTCON,T0IE                     ; TIMER0 Interrupt Enable
0079   178B           00216                 bsf             INTCON,GIE                      ; General Interrupt Enable
                      00217 
007A   01A3           00218                 clrf    rpm0_H
007B   01A4           00219                 clrf    rpm0_L
007C   01A5           00220                 clrf    rpm1_H
007D   01A6           00221                 clrf    rpm1_L
007E   01A7           00222                 clrf    rpm2_H
007F   01A8           00223                 clrf    rpm2_L
0080   01A9           00224                 clrf    rpm3_H
0081   01AA           00225                 clrf    rpm3_L
0082   0199           00226                 clrf    OldRpm1
0083   019A           00227                 clrf    OldRpm2
                      00228 
0084   0190           00229                 clrf    Timer1
0085   0191           00230                 clrf    Timer2
0086   0192           00231                 clrf    Timer3
0087   0193           00232                 clrf    Timer4
0088   300C           00233                 movlw   H'0c'
0089   009C           00234                 movwf   IntSkip
                      00235 
008A   0195           00236                 clrf    Scan1
008B   0196           00237                 clrf    Scan2
008C   0197           00238                 clrf    Scan3
008D   0198           00239                 clrf    Scan4
                      00240 
008E   0194           00241                 clrf    OldTimer1
008F   019B           00242                 clrf    IntRb0
0090                  00243 MainLoop
0090   1C1B           00244                 btfss   IntRb0,0
0091   2890           00245                 goto    MainLoop
0092   019B           00246                 clrf    IntRb0
                      00247 
0093   3004           00248                 movlw   H'04'           ; CPU clock(5MHz) prescale 1/4 * 60 (047868c0h=75000000)
0094   00B4           00249                 movwf   div1d
0095   3078           00250                 movlw   H'78'           ; ・・
0096   00B5           00251                 movwf   div1c
0097   3068           00252                 movlw   H'68'           ; ・・
0098   00B6           00253                 movwf   div1b
0099   30C0           00254                 movlw   H'c0'           ; LSB
009A   00B7           00255                 movwf   div1a
009B   0818           00256                 movf    Scan4,W         ; divider MSB       (Scan1-4)
009C   00B8           00257                 movwf   div2d
009D   0817           00258                 movf    Scan3,W         ; ・・
009E   00B9           00259                 movwf   div2c
009F   0816           00260                 movf    Scan2,W         ; ・・
00A0   00BA           00261                 movwf   div2b
00A1   0815           00262                 movf    Scan1,W         ; LSB
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00A2   00BB           00263                 movwf   div2a
00A3   2100           00264                 call    div32           ; Anser -> div3d,c,b,a 縲《urplus div4d,c,b,a return
                      00265 
00A4   083D           00266                 movf    div3c,W
00A5   1D03           00267                 btfss   STATUS,Z
00A6   2890           00268                 goto    MainLoop        ; Chataring Cut ( over 65535RPM )
                      00269 
                      00270 
                      00271 
                      00272 
00A7   0827           00273                 movf    rpm2_H,W
00A8   00A9           00274                 movwf   rpm3_H
00A9   0828           00275                 movf    rpm2_L,W
00AA   00AA           00276                 movwf   rpm3_L
                      00277 
00AB   0825           00278                 movf    rpm1_H,W
00AC   00A7           00279                 movwf   rpm2_H
00AD   0826           00280                 movf    rpm1_L,W
00AE   00A8           00281                 movwf   rpm2_L
                      00282 
00AF   0823           00283                 movf    rpm0_H,W
00B0   00A5           00284                 movwf   rpm1_H
00B1   0824           00285                 movf    rpm0_L,W
00B2   00A6           00286                 movwf   rpm1_L
                      00287 
00B3   083E           00288                 movf    div3b,W
00B4   00A3           00289                 movwf   rpm0_H
00B5   083F           00290                 movf    div3a,W
00B6   00A4           00291                 movwf   rpm0_L
                      00292         
00B7   3000           00293                 movlw   H'00'           ; work register clear
00B8   00AC           00294                 movwf   work_L
00B9   00AB           00295                 movwf   work_H
                      00296 
00BA   0824           00297                 movf    rpm0_L,W
00BB   0726           00298                 addwf   rpm1_L,W
00BC   00AC           00299                 movwf   work_L
00BD   1803           00300                 btfsc   STATUS,C
Message[305]: Using default destination of 1 (file).
00BE   0AAB           00301                 incf    work_H
00BF   0823           00302                 movf    rpm0_H,W
00C0   0725           00303                 addwf   rpm1_H,W
00C1   00AB           00304                 movwf   work_H
                      00305 
00C2   082C           00306                 movf    work_L,W
00C3   0728           00307                 addwf   rpm2_L,W
00C4   00AC           00308                 movwf   work_L
00C5   1803           00309                 btfsc   STATUS,C
Message[305]: Using default destination of 1 (file).
00C6   0AAB           00310                 incf    work_H
00C7   082B           00311                 movf    work_H,W
00C8   0727           00312                 addwf   rpm2_H,W
00C9   00AB           00313                 movwf   work_H
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00314 
00CA   082C           00315                 movf    work_L,W
00CB   072A           00316                 addwf   rpm3_L,W
00CC   00AC           00317                 movwf   work_L
00CD   1803           00318                 btfsc   STATUS,C
Message[305]: Using default destination of 1 (file).
00CE   0AAB           00319                 incf    work_H
00CF   082B           00320                 movf    work_H,W
00D0   0729           00321                 addwf   rpm3_H,W
00D1   00AB           00322                 movwf   work_H
                      00323 
00D2   1003           00324                 bcf             STATUS,C
00D3   0CAB           00325                 rrf             work_H,F
00D4   0CAC           00326                 rrf             work_L,F
00D5   1003           00327                 bcf             STATUS,C
00D6   0CAB           00328                 rrf             work_H,F
00D7   0CAC           00329                 rrf             work_L,F
                      00330 
                      00331 ;               movf    div3b,W
00D8   082B           00332                 movf    work_H,W
00D9   00C7           00333                 movwf   prm1b
                      00334 ;               movf    div3a,W
00DA   082C           00335                 movf    work_L,W
00DB   00C8           00336                 movwf   prm1a
00DC   2177           00337                 call    hexdec16
                      00338 
                      00339 ;               movf    prm3e,W
                      00340 ;               movwf   Led1
00DD   084A           00341                 movf    prm3d,W
00DE   009E           00342                 movwf   Led1
00DF   084B           00343                 movf    prm3c,W
00E0   009F           00344                 movwf   Led2
00E1   084C           00345                 movf    prm3b,W
00E2   00A0           00346                 movwf   Led3
00E3   084D           00347                 movf    prm3a,W
00E4   00A1           00348                 movwf   Led4
                      00349 
00E5   2890           00350                 goto    MainLoop
                      00351 
                      00352 
                      00353                 include                 math.inc
                      00001 ;****************  SRAM define  ********************
                      00002                 cblock  H'34'
  00000034            00003 div1d                           ;割られる数上位　（終了時には０になる）
  00000035            00004 div1c                           ; 〜
  00000036            00005 div1b                           ; 〜
  00000037            00006 div1a                           ;下位
  00000038            00007 div2d                           ;割る数上位       (変化せず戻る）
  00000039            00008 div2c                           ; 〜
  0000003A            00009 div2b                           ; 〜
  0000003B            00010 div2a                           ;下位
  0000003C            00011 div3d                           ;答え上位　　　　（答えが返る）
  0000003D            00012 div3c                           ; 〜
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  0000003E            00013 div3b                           ; 〜
  0000003F            00014 div3a                           ;下位
  00000040            00015 div4d                           ;余り上位　　　　（余りが返る、内部ワークにも使用）
  00000041            00016 div4c                           ; 〜
  00000042            00017 div4b                           ; 〜
  00000043            00018 div4a                           ;余り下位
  00000044            00019 divl1                           ;内部ループ用
  00000045            00020 divl2                           ;内部ループ用
  00000046            00021 diverr                          ;割る数が０であった場合に１をセットして戻る
                      00022 
  00000047            00023 prm1b                           ; 変換したい値（１６ビット。変換後は壊れる）
  00000048            00024 prm1a                           ;〜下位
  00000049            00025 prm3e                           ;10進格納場所（５バイト）
  0000004A            00026 prm3d           
  0000004B            00027 prm3c           
  0000004C            00028 prm3b           
  0000004D            00029 prm3a                           ;〜下位
  0000004E            00030 srlc1                           ; カウンタ（サブルーチンで使用）
  0000004F            00031 srwk1                           ; 一時余り格納場所（サブルーチンで使用）
                      00032 
                      00033                 endc
                      00034 
                      00035 
0100                  00036                 org             H'100'
                      00037 
                      00038 
                      00039 ;               movlw   0ffh            ;割られる数上位  (ffffffffh=4294967295)
                      00040 ;               movwf   div1d
                      00041 ;               movlw   0ffh            ; 〜
                      00042 ;               movwf   div1c
                      00043 ;               movlw   0ffh            ; 〜
                      00044 ;               movwf   div1b
                      00045 ;               movlw   0ffh            ;下位
                      00046 ;               movwf   div1a
                      00047 
                      00048 ;               movlw   00h             ;割る数上位       (989680h=10000000)
                      00049 ;               movwf   div2d
                      00050 ;               movlw   098h            ; 〜
                      00051 ;               movwf   div2c
                      00052 ;               movlw   096h            ; 〜
                      00053 ;               movwf   div2b
                      00054 ;               movlw   080h            ;下位
                      00055 ;               movwf   div2a
                      00056 
                      00057 ;               call    div32           ;答えは div3d,c,b,a 、余りは div4d,c,b,a に返る
                      00058 
                      00059 ;*********************************************************************
                      00060 ;---------------------------------------------------------------------
                      00061 
0100                  00062 div32           ;３２÷３２ビット＝３２ビットの割り算ルーチン
                      00063                 ;div1d,c,b,a ÷ div2d,c,b,a ＝ 結果 div3d,c,b,a  余り div4d,c,b,a
                      00064                 ;演算後、式の左項（割られる数）は壊れる
                      00065                 ;割る数が０（エラー）なら diverr に１を代入して戻る
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00066                 ;エラーの場合、引き数は変化しない
                      00067                 ;正常終了の場合は diverr=0 で戻る
                      00068                 ;32ビットで扱える数の最大は 4294967295　(42億9496万7295)
0100   3020           00069                 movlw   H'20'           ;20h=32
0101   00C4           00070                 movwf   divl1
0102   083B           00071                 movf    div2a,W
0103   00C3           00072                 movwf   div4a           ;割る数をワークにコピー
0104   083A           00073                 movf    div2b,W
0105   00C2           00074                 movwf   div4b
0106   0839           00075                 movf    div2c,W
0107   00C1           00076                 movwf   div4c
0108   0838           00077                 movf    div2d,W
0109   00C0           00078                 movwf   div4d
010A                  00079 di3201
010A   0DC3           00080                 rlf             div4a,F         ;左シフトする
010B   0DC2           00081                 rlf             div4b,F
010C   0DC1           00082                 rlf             div4c,F
010D   0DC0           00083                 rlf             div4d,F
010E   1803           00084                 btfsc   STATUS,W                ;割る数の上位ビットが見付かったなら di3202 へ
010F   2915           00085                 goto    di3202
0110   0BC4           00086                 decfsz  divl1,F
0111   290A           00087                 goto    di3201
0112   3001           00088                 movlw   H'01'
0113   00C6           00089                 movwf   diverr          ;割る数が０である、エラー終了
0114   0008           00090                 return
0115                  00091 di3202:
0115   01BF           00092                 clrf    div3a           ;答えのクリア
0116   01BE           00093                 clrf    div3b
0117   01BD           00094                 clrf    div3c
0118   01BC           00095                 clrf    div3d
0119   01C3           00096                 clrf    div4a           ;ワークのクリア
011A   01C2           00097                 clrf    div4b
011B   01C1           00098                 clrf    div4c
011C   01C0           00099                 clrf    div4d
011D   3020           00100                 movlw   H'20'           ;20h=32
011E   00C5           00101                 movwf   divl2
011F   0844           00102                 movf    divl1,W
0120   02C5           00103                 subwf   divl2,F         ;残り、実ループの回数
0121                  00104 di3203
0121   1003           00105                 bcf             STATUS,C                ;キャリフラグを０に
0122   0DB7           00106                 rlf             div1a,F         ;有効位置までシフトする
0123   0DB6           00107                 rlf             div1b,F
0124   0DB5           00108                 rlf             div1c,F
0125   0DB4           00109                 rlf             div1d,F
0126   0DC3           00110                 rlf             div4a,F         ;押し出されたビットをワークに
0127   0DC2           00111                 rlf             div4b,F
0128   0DC1           00112                 rlf             div4c,F
0129   0DC0           00113                 rlf             div4d,F
012A   0BC4           00114                 decfsz  divl1,F         ;割られる数を初期位置までシフトしておく
012B   2921           00115                 goto    di3203
012C                  00116 di3204
012C   0838           00117                 movf    div2d,W         ;div2c を w にコピー
012D   0240           00118                 subwf   div4d,W         ;比較
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

012E   1903           00119                 btfsc   STATUS,Z                ;結果が＝なら di3205 へ
012F   2934           00120                 goto    di3205
0130   1803           00121                 btfsc   STATUS,C                ;引くことが可なら di3210 へ
0131   294A           00122                 goto    di3210
0132   1C03           00123                 btfss   STATUS,C                ;引くことは不可なら di3211 へ
0133   2962           00124                 goto    di3211
0134                  00125 di3205:
0134   0839           00126                 movf    div2c,W
0135   0241           00127                 subwf   div4c,W
0136   1903           00128                 btfsc   STATUS,Z
0137   293C           00129                 goto    di3206
0138   1803           00130                 btfsc   STATUS,C
0139   294A           00131                 goto    di3210
013A   1C03           00132                 btfss   STATUS,C
013B   2962           00133                 goto    di3211
013C                  00134 di3206:
013C   083A           00135                 movf    div2b,W
013D   0242           00136                 subwf   div4b,W
013E   1903           00137                 btfsc   STATUS,Z
013F   2944           00138                 goto    di3207
0140   1803           00139                 btfsc   STATUS,C
0141   294A           00140                 goto    di3210
0142   1C03           00141                 btfss   STATUS,C
0143   2962           00142                 goto    di3211
0144                  00143 di3207:
0144   083B           00144                 movf    div2a,W
0145   0243           00145                 subwf   div4a,W
0146   1903           00146                 btfsc   STATUS,Z
0147   294A           00147                 goto    di3210
0148   1C03           00148                 btfss   STATUS,C
0149   2962           00149                 goto    di3211
014A                  00150 di3210:
014A   083B           00151                 movf    div2a,W
014B   02C3           00152                 subwf   div4a,F         ;ワークから下位を引く
014C   3001           00153                 movlw   H'01'           ;ワークには余りが残る
014D   1C03           00154                 btfss   STATUS,C
014E   02C2           00155                 subwf   div4b,F
014F   1C03           00156                 btfss   STATUS,C
0150   02C1           00157                 subwf   div4c,F
0151   1C03           00158                 btfss   STATUS,C
0152   02C0           00159                 subwf   div4d,F
0153   083A           00160                 movf    div2b,W
0154   02C2           00161                 subwf   div4b,F         ;ワークから２位を引く
0155   3001           00162                 movlw   H'01'
0156   1C03           00163                 btfss   STATUS,C
0157   02C1           00164                 subwf   div4c,F
0158   1C03           00165                 btfss   STATUS,C
0159   02C0           00166                 subwf   div4d,F
015A   0839           00167                 movf    div2c,W
015B   02C1           00168                 subwf   div4c,F         ;ワークから３位を引く
015C   1C03           00169                 btfss   STATUS,W
015D   03C0           00170                 decf    div4d,F         ;４上位 -1
015E   0838           00171                 movf    div2d,W
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

015F   02C0           00172                 subwf   div4d,F         ;ワークから上位を引く
0160   1403           00173                 bsf             STATUS,C                ;キャリフラグを１に
0161   2963           00174                 goto    di3212
0162                  00175 di3211
0162   1003           00176                 bcf             STATUS,C                ;キャリフラグを０に
0163                  00177 di3212
0163   0DBF           00178                 rlf             div3a,F         ;キャリフラグの内容を答えにシフトしてゆく
0164   0DBE           00179                 rlf             div3b,F
0165   0DBD           00180                 rlf             div3c,F
0166   0DBC           00181                 rlf             div3d,F
0167   08C5           00182                 movf    divl2,F         ;divl2 が 0 か検査
0168   1903           00183                 btfsc   STATUS,Z
0169   2975           00184                 goto    di3213          ;最下位まで処理したなら終了
016A   03C5           00185                 decf    divl2,F         ;ビット位置を１つ下げる（右へ）
016B   1003           00186                 bcf             STATUS,C                ;キャリフラグを０に
016C   0DB7           00187                 rlf             div1a,F         ;ワークへ１ビット左シフト
016D   0DB6           00188                 rlf             div1b,F
016E   0DB5           00189                 rlf             div1c,F
016F   0DB4           00190                 rlf             div1d,F
0170   0DC3           00191                 rlf             div4a,F
0171   0DC2           00192                 rlf             div4b,F
0172   0DC1           00193                 rlf             div4c,F
0173   0DC0           00194                 rlf             div4d,F
0174   292C           00195                 goto    di3204
0175                  00196 di3213
0175   01C6           00197                 clrf    diverr          ;正常終了
0176   0008           00198                 return
                      00199 
                      00200 
                      00201 ;*********************************************************************
                      00202 ;---------------------------------------------------------------------
                      00203 
                      00204                 ;結果はＢＣＤ数値（各下位４ビット）
                      00205 
                      00206 
0177                  00207 hexdec16        ;１６ビット（２バイト）数値を１０進数５桁のＢＣＤ値に変換する
                      00208                 ;引き数は prm1b(上位),prm1a(下位) の２バイト
                      00209                 ;結果は prm3e,prm3d,prm3c,prm3b,prm3a に得られ、右の prm3a が下位の数になる。
                      00210 
0177   304E           00211                 movlw   srlc1           ;格納場所初期値
0178   0084           00212                 movwf   4h              ;4h=fsr
0179   217F           00213                 call    devide          ;最下位変換
017A   217F           00214                 call    devide
017B   217F           00215                 call    devide
017C   217F           00216                 call    devide
017D   217F           00217                 call    devide          ;最上位変換
                      00218 
017E   0008           00219                 return
                      00220 
017F                  00221 devide                                  ;÷１０サブルーチン　（１０で除算）
017F   3010           00222                 movlw   d'16'           ;１６ビットくり返し
0180   00CE           00223                 movwf   srlc1
0181   01CF           00224                 clrf    srwk1
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0182                  00225 devide0
0182   1003           00226                 bcf     3h,0            ;キャリフラグのクリア
0183   0DC8           00227                 rlf     prm1a,1
0184   0DC7           00228                 rlf     prm1b,1
0185   0DCF           00229                 rlf     srwk1,1
0186   30F6           00230                 movlw   b'11110110'
0187   074F           00231                 addwf   srwk1,0
0188   1803           00232                 btfsc   3h,0
0189   00CF           00233                 movwf   srwk1
018A   1803           00234                 btfsc   3h,0
018B   0AC8           00235                 incf    prm1a,1
018C   0BCE           00236                 decfsz  srlc1,1
018D   2982           00237                 goto    devide0
018E   0384           00238                 decf    4h,1            ;4h=fsr
018F   084F           00239                 movf    srwk1,0
0190   0080           00240                 movwf   0h              ;余り (0h=indirect)
                      00241 
0191   0008           00242                 return
                      00243 
                      00244 ;---------------------------------------------------------------------
                      00245 ;*********************************************************************
                      00246 
                      00247 ;---------------------------------------------------------------------
                      00248 ;*********************************************************************
                      00354 
                      00355         end
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE 15


SYMBOL TABLE
  LABEL                             VALUE 

C                                 00000000
DC                                00000001
EEADR                             00000009
EECON1                            00000088
EECON2                            00000089
EEDATA                            00000008
EEIE                              00000006
EEIF                              00000004
F                                 00000001
FSR                               00000004
GIE                               00000007
GetLedPortA                       00000033
GetLedPortB                       0000003E
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
IntRb0                            0000001B
IntSaveFsr                        0000000F
IntSavePclath                     0000000E
IntSaveStatus                     0000000D
IntSaveWreg                       0000000C
IntSkip                           0000001C
InterruptProc                     00000004
Led1                              0000001E
Led2                              0000001F
Led3                              00000020
Led4                              00000021
Led5                              00000022
LedDrive                          0000001D
LedPort                           0000001D
MainLoop                          00000090
NOT_PD                            00000003
NOT_RBPU                          00000007
NOT_TO                            00000004
OPTION_REG                        00000081
OldRpm1                           00000019
OldRpm2                           0000001A
OldTimer1                         00000014
PCL                               00000002
PCLATH                            0000000A
PORTA                             00000005
PORTB                             00000006
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PowerOnReset                      0000006C
RBIE                              00000003
RBIF                              00000000
RD                                00000000
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE 16


SYMBOL TABLE
  LABEL                             VALUE 

RP0                               00000005
RP1                               00000006
Rb0Interrupt                      00000050
STATUS                            00000003
Scan1                             00000015
Scan2                             00000016
Scan3                             00000017
Scan4                             00000018
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
TMR0                              00000001
TRISA                             00000085
TRISB                             00000086
TempWreg                          0000004F
Timer1                            00000010
Timer2                            00000011
Timer3                            00000012
Timer4                            00000013
TimerAddEnd                       0000001A
TimerInterrupt                    00000015
W                                 00000000
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_CP_OFF                           00003FFF
_CP_ON                            0000000F
_HS_OSC                           00003FFE
_LP_OSC                           00003FFC
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_XT_OSC                           00003FFD
__16F84A                          00000001
add16ff                           
cmp16ff                           
cmpscc                            
cmpscs                            
cmpsnz                            
cmpsz                             
devide                            0000017F
devide0                           00000182
di3201                            0000010A
di3202                            00000115
di3203                            00000121
di3204                            0000012C
di3205                            00000134
di3206                            0000013C
di3207                            00000144
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE 17


SYMBOL TABLE
  LABEL                             VALUE 

di3210                            0000014A
di3211                            00000162
di3212                            00000163
di3213                            00000175
div1a                             00000037
div1b                             00000036
div1c                             00000035
div1d                             00000034
div2a                             0000003B
div2b                             0000003A
div2c                             00000039
div2d                             00000038
div32                             00000100
div3a                             0000003F
div3b                             0000003E
div3c                             0000003D
div3d                             0000003C
div4a                             00000043
div4b                             00000042
div4c                             00000041
div4d                             00000040
diverr                            00000046
divl1                             00000044
divl2                             00000045
hexdec16                          00000177
pcall                             
pgoto                             
prm1a                             00000048
prm1b                             00000047
prm3a                             0000004D
prm3b                             0000004C
prm3c                             0000004B
prm3d                             0000004A
prm3e                             00000049
rpm0_H                            00000023
rpm0_L                            00000024
rpm1_H                            00000025
rpm1_L                            00000026
rpm2_H                            00000027
rpm2_L                            00000028
rpm3_H                            00000029
rpm3_L                            0000002A
srlc1                             0000004E
srwk1                             0000004F
work_H                            0000002B
work_L                            0000002C
MPASM  5.11                          MAIN.ASM   7-22-2018  0:47:57         PAGE 18


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


0000 : X---XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXX---------- ----------------
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0180 : XXXXXXXXXXXXXXXX XX-------------- ---------------- ----------------
2000 : -------X-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:   373
Program Memory Words Free:   651


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     4 reported,     3 suppressed

