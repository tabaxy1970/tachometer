# tachometer
XLR250Bajaにはタコメーターが無い。作るしか。

・PICで7セグ4桁のタコメーターを作る。

・趣味の工作です。

プログラムはできたが、ハードウェアは点火タイミングのパルスを取るところで詰まってかれこれ2年頓挫。
一秒カウントして６０倍する馬鹿げた実装では無い。
割り込みを利用し、カウンターに確か20MHzを突っ込んで点火から点火までの時間を計測してRPMを表示するのでリアルタイム更新である。

・パルスゲット

初期はスパークコイルの一次側から取っていたのが行き詰まる原因であった。
いくら一次側とはいえかなりの電圧で、そこから弱電な素子に入力させようとする事自体が無理ゲーである。
気を取り直してCDIへ点火パルスを送るハーネスからパルスを取る事と、良さげな電圧範囲でした。
4Vp-pぐらいのパルスなのでダイオードで直流化して2SC1815で増幅したものを割り込みピン(RB0/INT)にプルダウンで接続。
パルスにノイズが結構あるのでCRローパスフィルターを前段に噛ませる。R=220Ω C=4.7uF カットオフ周波数 150Hz
動作の様子は、
https://youtu.be/-MtcJ4j0DM0


・回転のブレがアイドリング時100RPMあるが。。。

まず、CRフィルターのCが4,7uFだと7500RPMあたりでカウントしなくなる。2.2uFに変更で9000RPMオーバー(XLR250Bajaはそんなにまわしてはいけない!)でも計測が止まることはなくなった。また、割り込み時にTMR0の値を保存するようにしのがさらに悪化し、２つの波(CDIへの回転パルスとTMR0定期割り込み)の干渉波で回転数が化ける結果になったのでINT割り込み内でTMR0をリードするまでの到達クロック数を引く方法の方が安定した表示となった。数値安定化に4サンプリング平均で表示させることである程度低回転時のRPMのブレを吸収。しかし、下2桁はほぼ飾り状態は変わらず。タイマーIC555で発生させた矩形波を喰わせてプログラム側でブレているのかをテストしが、2100RPM程度のパルスを発生させると下1桁が＋2程度動く程度なので計測は問題ない模様。エンジン回転って低回転時は大きく変化しているようだ。たしかに4気筒のRSターボのアイドリング時はタコがブルブル震えていたっけ。